# introduction 
this documents will have the necessary work break-downs that helps to manage the task that at hands.

TOC 

## [Catel](https://catelproject.atlassian.net/wiki/display/CTL/Introduction)

Catel is yet another Framework (Or enterprise library, just use what ever you like ) with data handling, Diagnostics, logging, WPF Controls, and an MVVM-framework, so Catel is more than "just" another MVVM-framework or some nice extension Methods that you can use . It is more like a library that you want to inlucde in all the XAML application you are going to develop in the near future.


### Reference
[Catel](https://catelproject.atlassian.net/wiki/display/CTL/Introduction)
[Catel - Application Development platform with MVVM Support (WPF, SL, WP, WinRT)](http://catel.codeplex.com/)

##  MDX introduction 

While there some concept that are related to the MDX concepts. 

### Concepts 

* Cube and sub-Cube
* Dimension
* Hierarchy
* Level
* Measure
* Tuple
* Member
* Set ...


### Identifier
An Identifier is the name of an Microsoft SQL Server Analysis  service objects. 

Identifier can be categoried into the following two categories

1 Regular 
2 Delimited

while a regular identifier can be seen like below.

```
SELECT Measures.MEMBERS ON COLUMNS,
Product.Style.CHILDREN ON ROWS
FROM [Adventure Works]
```

while the Delimited identifier can be used like below.  

```
SELECT [Measures].MEMBERS ON COLUMNS,
[Product].[Style].CHILDREN ON ROWS
FROM [Adventure Works]
```

the delimited identifer have these brackets to tell it aparts from others.

### [Expressions (MDX)](http://technet.microsoft.com/en-us/library/ms145971.aspx)
an Expression is an combination of identifier, values, nd operators that Microsoft SQL Server Analysis Services can evaluate to get a result.

A simple expression can be the following. 

* Constant
* Scalar Function
* Object Identifier
* Hierarchy


while the complex expression can be built from the combination of the simple expression.

here is an exmple expression as follow.

```
WITH 
   MEMBER [Measures].[Special Discount] AS
   [Measures].[Discount Amount] * 1.5
SELECT 
   [Measures].[Special Discount] on COLUMNS,
   NON EMPTY [Product].[Product].MEMBERS  ON Rows
FROM [Adventure Works]
WHERE [Product].[Category].[Bikes]
```


#### [Using Cube and Subcube Expressions](http://technet.microsoft.com/en-us/library/ms145564.aspx)

You use cube and subcube expressions in Multidimensional Expressions (MDX) statements to define, manipulate, or retrieve data from a cube or subcube.

> A cube expression contains either a cube identifier or the CURRENTCUBE keyword, and therefore can only be simple expressions. 

while, giving a very simple expression, we can have the following code.

```
SELECT [Measures].[Internet Sales Amount] ON COLUMNS
FROM [Adventure Works]
```

from the above, the `[Adventure Works]` is actually a Cube's expression

and the keyword CURRENTCUBE, here is it in action

```
CREATE MEMBER CURRENTCUBE.[Measures].[Test] AS 1;
```

SubCube Expressions

a subcube expression can contain a subcube identifier or an MDX statements. 

> The MDX SELECT statement, for example, returns a subcube and can be used where subcube expressions are allowed, as shown in the following example:

```
SELECT [Measures].MEMBERS ON COLUMNS,
[Date].[Calendar Year].MEMBERS ON ROWS
FROM
(SELECT [Measures].[Internet Sales Amount] ON COLUMNS,
[Date].[Calendar Year].&[2004] ON ROWS
FROM [Adventure Works])
```


#### [Using Dimension Expressions](http://technet.microsoft.com/en-us/library/ms144820.aspx)

> You typically use dimension and hierarchy expressions when passing parameters to functions in Multidimensional Expressions (MDX) to return members, sets, or tuples from a hierarchy

while to use the Dimension Expression we can have two usage scenario. 

* Dimension Expression
* Hirarchy Expression

the first of Dimension Expression. 

we have the following.  

```
WITH MEMBER [Measures].[MeasureCount] AS
COUNT([Measures].MEMBERS)
SELECT [Measures].[MeasureCount] ON 0
FROM [Adventure Works]
```

and the example on the hierarchy expression is as follow  

```
WITH MEMBER [Measures].[CalendarLevelCount] AS
[Date].[Calendar].Levels.Count
SELECT [Measures].[CalendarLevelCount] ON 0
FROM [Adventure Works]

```

#### [Using Member Expressions](http://technet.microsoft.com/en-us/library/ms145495.aspx)

A member expression contains a member identifier, a member function, or an expression that can be converted to a member.

```
SELECT Amount ON 0
FROM [Adventure Works]
```

while to select a member, the most reliable member identifier is the member's unique name, which guarantee to identify a specific member in a cube. 

```
Dimension_Name
.[Hierarchy_Name.][[{Member_Name | &Member_Key}.]...] {Member_Name | &Member_Key} 
```

#### [Using Tupe Expression](http://technet.microsoft.com/en-us/library/ms144765.aspx)

> A tuple is made up of one member from every dimension that is contained within a cube. Therefore, a tuple uniquely identifies a single cell within the cube.

The complete expression of a tuple identifier is made up of one or more explicitly specified members, framed in parentheses:
```
(Member_expression [ ,Member_expression ... ] )
```

there could exist some relationship between the implicit referenced hierarchy and the implicit hierarchy. and if the explicit referenced hierarchy has a relationship with the implicit one, then if you reference the explicit reference, then you end up have reference the implicit referenced hierarchy. However, if there is no such relationship defined, then 

> * If the implicitly referenced hierarchy has a default member, the default member is added to the tuple.
* If the implicitly referenced hierarchy has no default member, the (All) member of the default hierarchy is used.
* If the implicitly referenced hierarchy has no default member the first member of the topmost level of the hierarchy is used.

NOTE: tupel does not need to be fully qualified

> A tuple that explicitly specifies a single member from every dimension that is contained within a cube is known as a fully qualified tuple. However, a tuple does not have to be fully qualified.


One-Member Tuple

> If the tuple expression has a single member, MDX converts the member into a one-member tuple for the purposes of evaluating the expression. In other words, providing the member expression [Measures].[TestMeasure] instead of a tuple expression is functionally equivalent to the tuple expression ( [Measures].[TestMeasure] ).


#### [Using Set Expressions](http://technet.microsoft.com/en-us/library/ms145491.aspx)

A set consists of an ordered list of zero or more tuples, A set that does not conain any tuples is known as an empty set.

syntax is as follow. 

```
{ [ { Tuple_expression | Member_expression } [ , { Tuple_expression | Member_expression } ] ... ] }
```

while the following example shows you how to do the query on Adventure Works. 

```
SELECT
{[Measures].[Internet Sales Amount], [Measures].[Internet Tax Amount]} ON COLUMNS,
{([Product].[Product Categories].[Category].&[4], [Date].[Calendar].[Calendar Year].&[2004]),
([Product].[Product Categories].[Category].&[1], [Date].[Calendar].[Calendar Year].&[2003]),
([Product].[Product Categories].[Category].&[3], [Date].[Calendar].[Calendar Year].&[2004])}
ON ROWS
FROM [Adventure Works]
```

consists of three tuples, each of which contains two explicit references to members on the Product Categories hierarchy of the Product dimension and the Calendar hierarchy of the Date dimension.



#### [Using Scalar Expressions](http://technet.microsoft.com/en-us/library/ms144886.aspx)

In Multidimensional expression (MDX), a scalar expresssion is an elements of MDX Syntax that, when evaluated, returns a single value within the context of a evaluation.

while the following shows an example on how we can leverage the the Scalar expression (returning a Scalar expression)

```
WITH
//Two calculated measures that return strings
MEMBER MEASURES.NumericString1 AS "10"
MEMBER MEASURES.NumericString2 AS "10"
//In this case, the + operator acts to concatenate the strings
MEMBER MEASURES.Concatenation AS MEASURES.NumericString1 + MEASURES.NumericString2
//Casting one value to an integer with the CINT function causes the second measure
//to be treated as an integer too, so that the + operator now acts to add the values
MEMBER MEASURES.Addition AS CINT(MEASURES.NumericString1) + MEASURES.NumericString2
SELECT
{MEASURES.NumericString1,MEASURES.NumericString2,MEASURES.Concatenation,MEASURES.Addition }
ON COLUMNS
FROM [Adventure Works]
```


#### [Working with Empty Values](http://technet.microsoft.com/en-us/library/ms145626.aspx)

> An empty value indicates that a specific member, tuple, or cell is empty. An empty cell value indicates either that the data for the specified cell cannot be found in the underlying fact table, or that the tuple for the specified cell represents a combination of members that is not applicable for the cube.

To remove empty rows or columsn from a query, you can use the NON EMPTY statement before the axis set definition, for example, the following query only returns the Product Category Bikes because that is the only Category that was sold in Calendar year 2001.

```
SELECT
{[Measures].[Internet Tax Amount]}
ON COLUMNS,
//Comment out the following line to display all the empty rows for other Categories
NON EMPTY
[Product].[Category].[Category].MEMBERS
ON ROWS
FROM [Adventure Works]
WHERE([Date].[Calendar].[Calendar Year].&[2001])
```

there is a special matrix on comparing the empty value against itself and true/false value. while the general rules is that when Empty return false except on comparing to itself, it returns Empty (not valid to compare empty with Empty); 
True only return true if the other is true, else, return false. 
False also return false. ... (the above is for the and operations)


### [Operators](http://technet.microsoft.com/en-us/library/ms144825.aspx)

Operator let you do the following actions. 

> * Change data, either permanently or temporarily.
* Search for values or objects that meet a specified condition.
* Implement a decision between values or expressions.
* Test for specific conditions before beginning or committing a transaction, or before executing specific statements.

the type of operation can be further divided into the following.


| Type of operation |  Use  |
| :-------- | :------|
| Assignment, associate results set columns with alias  | [Assignment Operators](http://technet.microsoft.com/en-us/library/ms145979.aspx) |
| Addition, subtraction, multiplication, division.     |   [Arithmetic Operators](http://technet.microsoft.com/en-us/library/ms144931.aspx) |
| Test for the truth of a condition, such as AND, OR, NOT and XOR.      |    [Bitwise Operators](http://technet.microsoft.com/en-us/library/ms145538.aspx) |
| Compare a value against another value or an expression.      |    [Comparison Operators](http://technet.microsoft.com/en-us/library/ms144788.aspx) |
| Either permanently or temporarily combine two strings into one string.     |    [Concatenation Operators](http://technet.microsoft.com/en-us/library/ms145503.aspx) |
| Either permanently or temporarily combine two set expressions into a single set.      |    [Set Operators](http://technet.microsoft.com/en-us/library/ms145496.aspx) |
| Performs an operation on one operand.      |    [Unary Operators](http://technet.microsoft.com/en-us/library/ms146036.aspx) |


the list of operators in precedence list are listed as below. 

> * IS
* AS
* DISTINCT
* :
* ^
* /, *
* +, -
* EXISTING
* <>, >=, =, <=, >, <
* NOT
* AND
* XOR
* OR


while there is a set of oeprators that are used to supported Converting Data types.

| Original Type |  Type Needed  | Conversion |
| -------- | ------| -------- |
| Level    | Set   |  &lt;level&gt;.member |
| Hierarchy    | Member   |  &lt;hierarchy&gt;.defaultmember |
| Member    | Tuple   |  (&lt;Member&gt;) |
| Tuple    | Member   |  &lt;tuple&gt;.item(0) |
| Level    | scalar   |  &lt;tuple&gt;.value |


### [Functions ](http://technet.microsoft.com/en-us/library/ms145563.aspx)

Multidimensional Expressions (MDX) has several categories of intrinsic functions to perform certain operations. The following table lists the function categories that are available in MDX.

the list of intrisic function will be ignored here. 

### [Comments](http://technet.microsoft.com/en-us/library/ms145585.aspx)

    //An example of a comment using the double-forward slash
    --An example of a comment using the double-hypen
    /*An example of a
    multi-line
    comment*/
    SELECT
    {[Measures].[Internet Sales Amount]}
    ON Columns,
    [Date].[Calendar].MEMBERS
    ON Rows
    FROM [Adventure Works]


### Reserved Keywords

IGNORED

### [Working with Members, Tuples, and SEts (MDX)](http://technet.microsoft.com/en-us/library/ms146040.aspx)

only a few example would be given in this situation.

* Member Functions
To explicitly state the member by name

```
    SELECT [Date].[Calendar Year].[CY 2001] on 0
    FROM [Adventure Works]
```

Or you can also use the FirstCHild function to return the same member, as the following example.

```
    SELECT [Date].[Calendar Year].FirstChild on 0
    FROM [Adventure Works]

```

* Tuple Functions
MDX provides a serveral function that return tuples. And they can be used anywhere that a tuple is accepted. 

```
SELECT {
   ([Measures].[Reseller Sales Amount]
      ,[Date].[Calendar Year].[CY 2003]
   )
, ([Measures].[Reseller Sales Amount]
      ,[Date].[Calendar Year].[CY 2004]
   )
}.Item(0)
ON COLUMNS 
FROM [Adventure Works]
```


* Set Functions 
we know that in the set operator, we have the following .

```
SELECT [Date].[Calendar Year].FirstChild on 0
FROM [Adventure Works]
```

which enumerate all the tuples from the 1st through the 4th quarter of calendar year 2002.

or you can just do the same thing with 

```
SELECT {
   [Calendar Quarter].[Q1 CY 2002], 
   [Calendar Quarter].[Q2 CY 2002], 
   [Calendar Quarter].[Q3 CY 2002], 
   [Calendar Quarter].[Q4 CY 2002]
   } ON 0
FROM [Adventure Works]
```

### [MDX Data Definition Statements (MDX)](http://technet.microsoft.com/en-us/library/ms144926.aspx)

In Multidimensional Expressions (MDX), data definition statements create, drop, and manipulate multidimensional objects. The following table lists the available data definition statements.


### [MDX Data Manipulation Statements (MDX)](http://technet.microsoft.com/en-us/library/ms144786.aspx)

In Multidimensional Expressions (MDX), data manipulation statements retrieve and manipulate data from multidimensional objects. The following table lists the data manipulation statements in MDX.

references:

[Comparison of SQL and MDX](http://technet.microsoft.com/en-us/library/aa216779(v=sql.80).aspx)
[Multidimensional Expressions (MDX) Reference](http://technet.microsoft.com/en-us/library/ms145506.aspx)
[MDX Statement Reference (MDX)](http://technet.microsoft.com/en-us/library/ms145610.aspx)
[MDX Scripting Statements (MDX)](http://technet.microsoft.com/en-us/library/ms145482.aspx)


## Introduction to Cubes

Cubes are the main objects in online analytic processing (OLAP), a technology that provides fast access to data in a data warehouse. A cube is a set of data that is usually constructed from a subset of a data warehouse and is organized and summarized into a multidimensional structure defined by a set of dimensions and measures.

some highlight on the blurbs, here are the details.

* Precalculated summary data called aggregations provides the mechanism for rapid and uniform response times to queries. Aggregations are created for a cube before end users access it. 
* The results of a query are retrieved from the aggregations, the cube's source data in the data warehouse, a copy of this data on the Analysis server, the client cache, or a combination of these sources. 
* An Analysis server can support many different cubes, such as a cube for sales, a cube for inventory, a cube for customers, and so on

Every Cube has a schema, which is the set of joined tables n the data warehouse from which the cube draw its source data.

also some facts on the Cube's concepts. 

the central table in the schema is the fact table, the source of the cube's measurees. The other tables are dimension tables, the sources of the cube's dimensions.

A cube is defined by the measures and dimensions that it contains.  let 's shown by a simple example as follow. 

> a cube for sales analysis includes the measures Item_Sale_Price and Item_Cost and the dimensions Store_Location, Product_Line, and Fiscal_Year. This cube enables end users to separate Item_Sale_Price and Item_Cost into various categories by Store_Location, Product_Line, and Fiscal_Year.

SUMMARY: 

the Measures reflect an aspect of interest, while the Dimension extended the Measure by multitude (by adding categories, attributes and others into the 

### References

[Introduction to Cubes](http://technet.microsoft.com/en-us/library/aa216365(v=sql.80).aspx)

## common review issues. 

### about the Hash operation

about the hash operation, 

* use Add instead of set 

for example, if you working with some dictionary, instead of `_cacheCountContext.[name] = reportItem`. you would probably more inclined to do the following. `_cacheCountContext.Add(name, reportItem)`

* from a getter do not create new instances 

e.g. the following handling is not welcomed.


```
public static ReprotItem EmptyReportItem 
{
  get 
  {
     return new ReportItem 
     {
        UseCount = 0,
        LastAccessTime = DateTime.UtcNow,
        CreateTime = DateTime.UtcNow,
     }
  }
}
```

while this not recommended, you have options, 1 is to use just the old-style new object when the object is needed, or option 2 is to use the create a method, such as 

```
public static ReprotItem MakeEmptyReportItem()
{
  return new ReportItem 
  {
     UseCount = 0,
     LastAccessTime = DateTime.UtcNow,
     CreateTime = DateTime.UtcNow,
  }
}
```

* Notification Object should not be used as a Service 
NotificationObject is a base class for ViewModel class, and should not be used as base class for Service class, if you mean to notify the client of the Servcie of certain changes to happen, better to use some Event mechanism.

e..g 

```
    /// <summary>
    /// Implemenation class for <see cref="ILayoutManagerService"/>
    /// </summary>
    public class LayoutManagerService : NotificationObject, ILayoutManagerService
    {
       #region Private Fields 
       private bool _isInChangingLayout;
       #endregion 
       
        /// <summary>
        /// Gets or sets a value indicating whether the layout manager is doing a Chaning Layout operation.
        /// </summary>
        public bool IsInChangingLayout {
        get
        {
           return _isInChaningLayout;
        }
        set
        {
          _isInChangingLayout = value; 
          RaisePropertyChanged(() => IsInChaningLayout);
        }
        
    }
```


while if the Service is meant only to share status, then you can just do the following.

```
    /// <summary>
    /// Implemenation class for <see cref="ILayoutManagerService"/>
    /// </summary>
    public class LayoutManagerService : ILayoutManagerService
    {
        /// <summary>
        /// Gets or sets a value indicating whether the layout manager is doing a Chaning Layout operation.
        /// </summary>
        public bool IsInChangingLayout { get; set; }
    }
```

While if you have the desire to notify when it changed, you may do this via event. 

```
    /// <summary>
    /// Implemenation class for <see cref="ILayoutManagerService"/>
    /// </summary>
    public class LayoutManagerService : ILayoutManagerService
    {
        /// <summary>
        /// Gets or sets a value indicating whether the layout manager is doing a Chaning Layout operation.
        /// </summary>
        public bool IsInChangingLayout { get; set; }
        
        /// <summary>
        /// Notify when the IsInChaningLayout has changed. 
        /// <summary>
        public event Action<bool> IsInChaningLayoutChanged;
    }
```

* shorter code - use Collection Initializer or chaining methods calls 
the following code 


```
    var cacheList = new List<LayoutViewModel>;
    cacheList.Add(selectedLayout);
```

can be changed to the following 

```
   var cacheList = new List<LayoutViewModel> { selectedLayout }
```

also the following code 

```
var history = _layoutManagerProvider.GetLayoutReports();
_useCountContext = history.ToDictionary(x => x.Name);
```

while this can be changed the following by code as follow. 

```
_useCountContext = _layoutManagerProvider.GetLayoutReports().ToDictionary(x => x.Name);
```


* Abstract class 's constructor should be made protected 

the constructor of a abstract base class should be made protected. 

```
        public LayoutViewModel(ILayoutManagerService layoutManagerService)
        {
            Guard.Argument(layoutManagerService, "layoutManagerService").IsNotNull().SetField(ref _layoutManagerService);

            Documents = new ObservableCollection<DocumentContentViewModel>();
        }
```

while in reality, it should really be made protected as this it does not make sense to create instances of the abstract class, so the code should be changed to the following. 

```
        protected LayoutViewModel(ILayoutManagerService layoutManagerService)
        {
            Guard.Argument(layoutManagerService, "layoutManagerService").IsNotNull().SetField(ref _layoutManagerService);

            Documents = new ObservableCollection<DocumentContentViewModel>();
        }
```

* A function only does what its name tells, do not over-do 
A function should only do what its title says, let's see an bad example first.

```
        /// <summary>
        /// Set a layout's Visible to true
        /// </summary>
        /// <param name="layout">Layout to set</param>
        protected void SetVisibile(LayoutViewModel layout)
        {
            Guard.Argument(layout, "layout").IsNotNull();

            Layouts.Where(x => x != layout).ForEach(li => li.IsVisible = false);

            var layoutItem = Layouts.First(x => x == layout);
            if (layoutItem != null)
            {
                layoutItem.IsVisible = true;
                CancelStopLayout(layoutItem);
            }
            
            RevaluateCommandsCanExecute();
            RaisePropertyChanged(() => SelectedLayout);
            LayoutsCacheManager.UpdateCacheHit(layout.Name);

            if (layoutItem != null)
            {
                if (!layoutItem.LoadComplete)
                {
                    layoutItem.CreateDocuments();
                    layoutItem.OnRestoreLayout();
                    layoutItem.LoadComplete = true;
                }

                if (!layoutItem.IsDataConnected)
                {
                    layoutItem.IsDataConnected = true;
                }
            }

            IsInChangingLayout = false;
            OnSelectedLayoutChanged();
        }
```
while it is used by the ChangeLayout method 

```
        private void ChangeLayout(LayoutViewModel layout, LayoutViewModel previous)
        {
            IsInChangingLayout = true;
            LayoutViewModel storedItem;
            LayoutViewModel swappedOutItem = null;

            // cache missed or cache content to be changed (cases when revert a layout)
            if (!LayoutsCacheManager.Contains(layout.Name) 
                || (LayoutsCacheManager.TryGet(layout.Name, out storedItem) && storedItem != layout))
            {
                var oldCachedItem = LayoutsCacheManager.SwapIn(layout.Name, layout);
                swappedOutItem = oldCachedItem == null ? null : oldCachedItem.Content;
                Layouts.Remove(swappedOutItem);
                Layouts.Add(layout);
            }

            if (swappedOutItem != null)
            {
                StopLayout(swappedOutItem);
            }

            if (previous != null && previous != swappedOutItem)
            {
                StopLayout(previous);
            }

            SetVisibile(layout);
        }
```

we can split the code as follow.

```
       private void ChangeLayout(LayoutViewModel layout, LayoutViewModel previous)
        {
            IsInChangingLayout = true;
            LayoutViewModel storedItem;
            LayoutViewModel swappedOutItem = null;

            // cache missed or cache content to be changed (cases when revert a layout)
            if (!LayoutsCacheManager.Contains(layout.Name) 
                || (LayoutsCacheManager.TryGet(layout.Name, out storedItem) && storedItem != layout))
            {
                var oldCachedItem = LayoutsCacheManager.AddOrReplace(layout.Name, layout);
                swappedOutItem = oldCachedItem == null ? null : oldCachedItem.Content;
                Layouts.Remove(swappedOutItem);
                Layouts.Add(layout);
            }

            if (swappedOutItem != null)
            {
                StopLayout(swappedOutItem);
            }

            if (previous != null && previous != swappedOutItem)
            {
                StopLayout(previous);
            }

            SetVisibile(layout);
            CancelStopLayout(layout);
            RevaluateCommandsCanExecute();
            RaisePropertyChanged(() => SelectedLayout);
            LayoutsCacheManager.UpdateCacheHit(layout.Name);
            LoadsDocumentsIfNotLoaded(layout);
            IsInChangingLayout = false;
            OnSelectedLayoutChanged();
        }
        
                /// <summary>
        /// Set a layout's Visible to true
        /// </summary>
        /// <param name="layout">Layout to set</param>
        private void SetVisibile(LayoutViewModel layout)
        {
            Guard.Argument(layout, "layout").IsNotNull();
            Debug.Assert(Layouts.Contains(layout), string.Format("Internal error! Cannot find {0} in Layouts collectoin", layout.Name));

            Layouts.Where(x => x != layout).ForEach(li => li.IsVisible = false);
            layout.IsVisible = true;
        }

        private void LoadsDocumentsIfNotLoaded(LayoutViewModel layout)
        {
            if (layout != null)
            {
                if (!layout.LoadComplete)
                {
                    layout.CreateDocuments();
                    layout.OnRestoreLayout();
                    layout.LoadComplete = true;
                }

                if (!layout.IsDataConnected)
                {
                    layout.IsDataConnected = true;
                }
            }
        }
```

* abstract method versus Provider (factory)  - Factory method vs. abstract factory pattern
while in the LayoutManagerViewModel there is a abstract class that is called `CreateLayout()` 
```
public abstract class LayoutManagerViewModel 
{
        protected abstract LayoutViewModel CreateLayout();
}
```

and it is implemented by the derived class, here is the deal.

```

public abstract class ViewerLayoutManagerViewModel 
{
        protected override LayoutViewModel CreateLayout()
        {
            var layoutItem = new ViewerLayoutViewModel(
                _resultsViewModelFactory,
                _reportSelectorViewModel,
                _ViewerFilterViewModel,
                _layoutChangeSavingService,
                _environmentService,
                LayoutManagerService);
            return layoutItem;
        }

}

```

while it is a stylet you sometimes may choose the Factory method pattern, whlie sometimes to achieve better decoupling, you might choose the abstract factory pattern. here is the deal.

so first of all, we will need an abstract factory interface, here is the deal. 

```
    /// <summary>
    /// Factory to make objects of <see cref="LayoutViewModel"/>or its derived.
    /// </summary>
    public interface ILayoutViewModelFactory
    {
        /// <summary>
        /// Create <see cref="LayoutViewModel"/> instance
        /// </summary>
        /// <returns>Object created.</returns>
        LayoutViewModel CreateLayout();
    }
```

and we can create the Factory concrete class of the ILayoutViewModelFactory, the class's name is `ViewerLayoutViewModelFactory`

```
    /// <summary>
    /// <see cref="LayoutViewModel"/> factory provides <see cref="ViewerLayoutViewModel"/>
    /// </summary>
    internal class ViewerLayoutViewModelFactory : ILayoutViewModelFactory
    {
        #region Fields
        private readonly IUnityContainer _unityContainer;
        private readonly ViewerFilterViewModel _ViewerFilterViewModel;
        #endregion 

        #region Constructor
        public ViewerLayoutViewModelFactory(
            IUnityContainer unityContainer,
            ViewerFilterViewModel ViewerFilterViewModel)
        {
            _unityContainer = unityContainer;
            _ViewerFilterViewModel = ViewerFilterViewModel;
        }
        #endregion

        #region Methods

        #region Impl (ILayoutViewModelFactory)
        public LayoutViewModel CreateLayout()
        {
            return _unityContainer.Resolve<ViewerLayoutViewModel>(
                new ResolverOverride[]
                {
                    new DependencyOverride(typeof(ViewerFilterViewModel), _ViewerFilterViewModel)
                });
        }
        #endregion
        #endregion
    }
```

the key here is that since we had made the `ReportConfiguration` dependency to be singleton dependency, then there would be no such issue any more, check the `LayoutManagerViewModel` constructor for details.

```
        protected LayoutManagerViewModel(
            ILayoutManagerProvider layoutManagerProvider, 
            LayoutManagerContext layoutManagerContext,
            IUITaskSchedulerService uiTaskSchedulerService,
            CacheManagerOptions cacheManagerOptions,
            ICacheManager<LayoutViewModel> cacheManager,
            ILayoutViewModelFactory layoutViewModelFactory)
```


## install MySql

you can install MySql through the zip file or through the MSI installer. 


### Install the MySQL services

after you have added the mysqld in the service through the following commands,

    c:\ProgramFiles\mysql-5.6.17\bin\mysqld --install
    
then you can find MySQL appears in the `services.msc` control panel

Admmonition: you can add the path to MySQL to the environmental variables.

    set MYSQL_HOME=c:\ProgramFiles\mysql-5.6.17
    set PATH=%PATH%;%MYSQL_HOME%\bin


after the installation of the MySQL service, you an now start the service with 

    net start MySQL

### Remove the service manually 

First you can stop the MySQL services, here is what you can do 

    net stop MySQL

after that you can remove the services.

    c:\ProgramFiles\mysql-5.6.17\bin\mysqld --remove 

REMEMBER, do run the above commands when you are in the directory of the mysql binaries.

### references

[Installing MySQL on Microsoft Windows Using a noinstall Zip Archive](http://dev.mysql.com/doc/refman/5.7/en/windows-install-archive.html)

## JRuby and Rails

where from the references page, you can do the following to create the rails server. 

    jruby -S rails new testapp -d mysql -m http://jruby.org/rails3.rb 

You might need to do that via the windows bash shell. (not sure why we need to do thatt..)

after the install is complete, you will need to do the following. 

    open config\database.yml 



### References
[安装jruby和rails，创建 application](http://wj196.iteye.com/blog/980490)


## OLAP and Cubes

Concepts:

OLTP： Online Transaction Processing Database
OLAP: Online Analysis Processing Database


the proobem with traditional LOTP database, the problem with the OLAP database is that :

1. OLTP takes "Customer waiting in the line" thing to process long running procedures and others..
2. OLTP datbase records individual records, such as (hard to do OLAP) process

    On April 2, John Smith bought a case of apples from Jane Doe for $5.00.
3. OLTP database constatnly update their data.



while the speical structure of the OLAP Database

1. OLAP isolated from the OLTP database
2. OLAP fewer tables and different types of schema. (star schema, which keeps the number of joins to a minimum by arranging table a star schema)

FACT: the central table in the schema is a fact table. 

facts table contains Numeric data, such as zip codes...

the facts in a dimension are called members, By design, OLAP databases group the related facts in a member into hierarchies whenever the underlying data supports that type of structure...
e..g

* Year
* Quater
* Month
* Order Date


### PUtting the table together

ETL (Extract, Transform, and Load (ETL0 

SQL server has built-in utility called Data Transformation Services (DTS) that performs the ETL tasks.


### Understanding the data Cubes

the magnititude of e cube, according to the Microsoft Page, the largest cudeb in tyeh world is currently 1.4 terabytes and its average response time to any quesry is 1.2 seconds. 

### Building Your Own Cubes

what to use to build the cubes, including Microsoft Excel, Analysis Services 2000 (Which comes with Microsoft SQL Server 2000), or OLAP Service 7.0 the prcedecessor of Analysis Services;

### References: 

[Just What Are Cubes Anyway? (A Painless Introduction to OLAP Technology)](http://msdn.microsoft.com/en-us/library/office/aa140038(v=office.10).aspx)

## Intoduction to Cubes

### Cubes

this is by far the most accurate technical explaination. here is the details 

* Measure 
> A measure is a fact, which is a transactional value or measurement that a user may want to aggregate. Measures are sourced from columns in one or more source tables, and are grouped into measure groups.

* Dimensions
> A dimension is a group of attributes that represent an area of interest related to the measures in the cube, and which are used to analyze the measures in the cube. For example, a Customer dimension might include the attributes Customer Name, Customer Gender, and Customer City, which would enable measures in the cube to be analyzed by Customer Name, Customer Gender, and Customer City. Attributes are sourced from columns in one or more source tables. The attributes within each dimension can be organized into hierarchies to provide paths for analysis. 
* Cube
> A cube is then augmented with calculations, key performance indicators (KPIs), actions, partitions, perspectives, and translations. 

A cube is essentially synonymous with a Unified Dimensional Model (UDM). For more information about UDMs, seeUnified Dimensional Model. In Microsoft SQL Server 2005 Analysis Services (SSAS), a cube is developed based on tables and views that are modeled in a data source view.

A cube is defined by its measures and dimensions, 

while there is a image, where quoted below.  

![Cube example](http://i.technet.microsoft.com/dynimg/IC136050.gif)


### Measures
what is measures, the Values within the cube cells represents teh two measures, in our example, it is "Packages" and "last"

### Dimensions
e.g. the ROute Dimension tellls by which which means the imports reach their destination. 

### Aggregates
Business users of a cube can determine the vaule of any measures of every dimension, regardless of the level of the member of witin the dimensions, ecause Analysis Services aggregates values at upper levels as needed. 

aggregate also have a sample diagram, here is the code below. 

![Diagram of measures alongside the time dimension](http://i.technet.microsoft.com/dynimg/IC171356.gif)


### Fact table group and the snowflake schema

alll the dimension tables table are joined to the fact table in a start schema, Another common schema is a snwoflake schema, in which one of more dimension tables joins to another dimension table. 

References: 
[Introduction to Cubes](http://technet.microsoft.com/en-us/library/ms174587(v=sql.90).aspx)

###  Measures and Measures Groups 
A measure represents a column that contains quantifiable data, usually numeric, that can be aggregated. A measure is generally mapped to a column in a fact table.


Weighting:

> You can also use a measure expression to define the value of a measure, based on a column in a fact table as modified by a Multidimensional Expression. A measure expression enables weighting of measure values; for example, currency conversion can be used to weight a sales measure by an exchange rate.

so that a measure can be 

* weighted
* calculated member by using a Multidimensional Expressions (MDX) to provide a calculated value for a measure based on other measures in the cube. 

### Measure Groups
In a cube, measures are grouped by their underlying fact tables into measure groups.
 
> In a cube, measures are grouped by their underlying fact tables into measure groups. Measure groups are used to associate dimensions with measures. Measure groups are also used for measures that have distinct count as their aggregation behavior. Placing each distinct count measure into its own measure group optimizes aggregation processing.

while a Measure group may have the granularity as its member, the granularity is as follow.  

depends on the Primary/Foreign key relationship, the granualirty on each dimension can be different.

Measure groups Aggregate Functions 

> When a dimension is used to organize measures in a measure group, the measure is summarized along the hierarchies contained in that dimension. 

## Dimension Relationship

a regular dimension relationship between a cube and a measure gropu exists when teh key column for hte dimension is joined directly to the fact table. 
**it is based on the primary key-foreign key** relationship

there exists a reference dimension relationship between a cube dimension...


![Logical Diagram, Referenced dimension relationship](http://i.technet.microsoft.com/dynimg/IC147812.gif) 


and when you you translate that into the table schema (in design view), it can be like the following 

![Logical Diagram, Referenced dimension relationship](http://i.technet.microsoft.com/dynimg/IC99669.gif)


NOTE: the number of reference diemsnion is not limited. 


### Fact Dimension Relationship 

Fact dimensions, frequently referred to as degenerate dimensions, are standard dimensions that are constructed from attribute columns in fact tables instead of from attribute columns in dimension tables. Useful dimensional data is sometimes stored in a fact table to reduce duplication. 

e.g. 

![Columsn in Fact table can support dimension](http://i.technet.microsoft.com/dynimg/IC92357.gif)

### Many to Many Dimension Relationship

In most dimensions, each fact joins to one and only one dimension member, a good example would be 

> For example, a bank customer might have multiple accounts (checking, saving, credit card, and investment accounts), and an account can also have joint or multiple owners. The Customer dimension constructed from such relationships would then have multiple members that relate to a single account transaction

![Logical Schema Many to many relationship](http://i.technet.microsoft.com/dynimg/IC23854.gif)

Reference: [Dimension Relationships](http://technet.microsoft.com/en-us/library/ms175669(v=sql.90).aspx)


### Calculation

different type of Calculation

* Calculated Members
Calculated members can be defined for any dimension, including the measures dimension. 
there are caculated members created on the Measures dimension are called Calculated measures. 


e.g. 

```
([Measures].[Price_to_Ship] - [Measures].[Cost_to_Ship]) /
[Measures].[Volume_in_Cubic_Meters]
```

* Named Sets
created by the CREATE SET MDX 

* Script Commands
A script command is an MDX script, included as part of the definition of the cube. Script commands let you perform almost any action that is supported by MDX on a cube, such as scoping a calculation to apply to only part of the cube. 


### Key Performance Indicators

In business terminology, a Key performance indicator (KPI) may have different meaning in different context, ... 

what is KPI in the Microsoft SQL Server 2005 Analysis Server (SSAS), a KPI is a collection of calculations, which are  associated with a measure group in a cube, that are used to evaluate business success.  

what are the main KPI temrs in the KPI analysis Services

* Goal
* Value
* Status
* Trend
* Status Indicator
* Trend Indicator
* Display Folder
* Parent KPI
* Current time member
* Weight

ignore the rest discussion on the KPIs..


### Action 

Action can be stored and presented to the employed by the client application, it is pretty much like the Stored Procedure in the SQL scenario.

the type of Actions can include the following.

* CommandLine
* DataSet
* Drillthrough
* Html
* Proprietary
* Report
* Rowset
* Statement
* URL

the rest is ignored for clarity of the explaination
[Actions](http://technet.microsoft.com/en-us/library/ms174515(v=sql.90).aspx)

### Partitions

a prelude, the partition seems to be rather exclusive, while the Partition are used by the Measure group, Every measure gropu has at least one partition. this partition is created when the measure group is defined. 

some notes on the Partition:

while the partition is not visible to the user, however, administrators can configure , add, drop partitions. 


The structure of a partition must match the structure of its measure group, which means that hthe measure gropu must be defined in the partition.

NOTE: Data Sources and Partition Storage

> A partition is based either on a table or view in a data source, or on a table or named query in a data source view. The location where partition data is stored is defined by the data source binding. Typically, you can partition a measure group horizontally or vertically:


## Perspectives 

Cubes can be very complex objects for users to explorer in Microsoft SQL Server 2005 Analysis Services; 

NOTE: the reason of introducing the Perspective is that it can help reduce the complexity of the perceived Cube. It is more like a view in the traditional database.

what can be hidden/displayed in a perspective:

* Dimensions
* Attributes
* Hierarchies
* Measure groups
* Measures
* Key Performance Indicators (KPIs)
* Calculations (calculated members, named sets, and script commands)
* Actions

### Cube Translations

A cube translation is a language-specific representation of the name of a cube object, such as a caption or a display folder, Analysis services also supports translation of dimension and member names.

this is not quit useful in our scope of discussion, so that I will leave the discussion unanswered. 

## Set up the Adventure Works Tutorial

where there is a tutorial in the MSDN.. the adventure Works link is as [Multidimensional Modeling (Adventure Works Tutorial)][adventure_works_tutorial]

[adventure_works_tutorial]: http://msdn.microsoft.com/en-us/library/ms170208.aspx


## C# tips - Event to Command conversion with the help from the System.Windows.Interactivity
the assembly System.Windows.Interactivity is from the Microsoft Expression Blend 3 Software development Toolkit. where you can include it in your code. if you are in the enterprise environmen, you can access that from the following location. 

        <dependency>
          <groupId>com.microsoft</groupId>
          <artifactId>Expression</artifactId>
          <version>4.0.0.0</version>
          <type>zip</type>
        </dependency>

But if you have installed it locally, you can find it here ;

    C:\Program Files\Microsoft SDKs\Expression\Blend 3\Interactivity\Libraries\WPF\System.Windows.Interactivity.dll

to use it , hereby I referenced the [WPF Events to Command redirection using System.Windows.Interactivity][event_command_redirection_using_interactivity].


the key here is first you have to implements the 
`TriggerAction<AssociatedObjectT>`

class, which has this `inovke(object parameter)` method to implements.

then it is necessary for you to have 

    <TextBox Text="{Binding SampleCommandParam, UpdateSourceTrigger=PropertyChanged}" Margin="20">
        <i:Interaction.Triggers>
            <i:EventTrigger EventName="TextChanged">
                <local:EventsToCommand Command="{Binding SampleCommand}"
                                       CommandParameter="{Binding SampleCommandParam}"></local:EventsToCommand>
            </i:EventTrigger>
        </i:Interaction.Triggers>
    </TextBox>  

so that you can associate the Control with the Actoin trigger that it is associated with.

code as below.


```
// EventToCommandDemoViewModel
using System;
using System.ComponentModel;
using System.Windows.Input;
using Interactivity_EventToCommand.Commands;

namespace Interactivity_EventToCommand.ViewModels
{
    /// <summary>
    /// Event to Command Sample View Model
    /// </summary>
    public class EventToCommandDemoViewModel : INotifyPropertyChanged
    {
        #region Fields

        public ICommand _sampleCommand;

        private string _message;

        private string _sampleCommandParam;
        #endregion
        #region Constructor
        public EventToCommandDemoViewModel()
        {
            _sampleCommand = new DelegateCommand(SampleCommandExecuted);
        }
        #endregion
        #region Properties
        public ICommand SampleCommand
        {
            get
            {
                return _sampleCommand;
            }
        }

        public string Message
        {
            get
            {
                return _message;
            }

            set
            {
                if (_message == value)
                {
                    return;
                }

                _message = value;
                RaisePropertyChanged("Message");
            }
        }

        public string SampleCommandParam
        {
            get
            {
                return _sampleCommandParam;
            }

            set
            {
                if (_sampleCommandParam == value)
                {
                    return;
                }

                _sampleCommandParam = value;
                RaisePropertyChanged("SampleCommandParam");
            }
        }
        #endregion 
        #region Events
        public event PropertyChangedEventHandler PropertyChanged;
        #endregion
        #region Helper
        #region INotifyPropertyChanged
        protected void RaisePropertyChanged(string propName)
        {
            if (propName == null)
            {
                throw new ArgumentNullException("propName");
            }

            var temp = PropertyChanged;
            if (temp != null)
            {
                temp(this, new PropertyChangedEventArgs(propName));
            }
        }
        #endregion
        #region Command Handler

        private void SampleCommandExecuted(object parameter)
        {
            Message = parameter.ToString();
        }
        #endregion
        #endregion
    }
}
```

and the 
```
// EventsToCommand.cs
using System.Windows;
using System.Windows.Input;
using System.Windows.Interactivity;

namespace Interactivity_EventToCommand.Commands
{
    public class EventsToCommand : TriggerAction<FrameworkElement>
    {
        public ICommand Command
        {
            get
            {
                return (ICommand)GetValue(CommandProperty);
            }

            set
            {
                SetValue(CommandProperty, value);
            }
        }
        // Using a DependencyProperty as the backing store for CommandParameter.  This enables animation, styling, binding, etc...
        public static readonly DependencyProperty CommandProperty = DependencyProperty.Register(
            "Command", typeof(ICommand), typeof(EventsToCommand), new UIPropertyMetadata(null));
        public object CommandParameter
        {
            get
            {
                return (object)GetValue(CommandParameterProperty);
            }

            set
            {
                SetValue(CommandParameterProperty, value);
            }
        }
        // Using a DependencyProperty as the backing store for CommandParameter.  This enables animation, styling, binding, etc...
        public static readonly DependencyProperty CommandParameterProperty =
            DependencyProperty.Register(
                "CommandParameter", typeof(object), typeof(EventsToCommand), new UIPropertyMetadata(null));
        #region Methods

        #region Impl (TriggerAction<FrameworkElement>)

        protected override void Invoke(object parameter)
        {
            if (Command == null) return;
            if (Command is RoutedCommand)
            {
                var rc = Command as RoutedCommand;
                if (rc.CanExecute(CommandParameter, base.AssociatedObject))
                {
                    rc.Execute(CommandParameter, base.AssociatedObject);
                }
            }
            else
            {
                if (Command.CanExecute(CommandParameter))
                {
                    Command.Execute(CommandParameter);
                }
            }
        }

        #endregion

        #endregion
    }
}

```

I have implemented my own version of the DelegateCommand, it is like below. 

```
//DelegateCommand.cs
using System;
using System.Windows.Input;

namespace Interactivity_EventToCommand.Commands
{
    public class DelegateCommand : ICommand
    {
        #region Fields

        private Func<object, bool> _canExecuteHandler;

        private Action<object> _executeHandler;
        #endregion

        #region Constructor

        public DelegateCommand(Action<object> executeHandler, Func<object, bool> canExecuteHandler = null)
        {
            _canExecuteHandler = canExecuteHandler;
            _executeHandler = executeHandler;
        }
        #endregion

        public bool CanExecute(object parameter)
        {
            return _canExecuteHandler == null || _canExecuteHandler(parameter);
        }

        public event System.EventHandler CanExecuteChanged;

        public void Execute(object parameter)
        {
            if (null != _executeHandler)
            {
                _executeHandler(parameter);
            }
        }

        #region Methods 
        public void RaiseCanExecuteChanged()
        {
            var temp = CanExecuteChanged;
            if (temp != null)
            {
                temp(this, EventArgs.Empty);
            }
        }
        #endregion
    }
}
```
below is the Views for the test app

```
<UserControl x:Class="Interactivity_EventToCommand.Views.EventToCommandDemo"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:local="clr-namespace:Interactivity_EventToCommand.Commands"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <Grid
        Background="Beige"
        >
        <Grid.RowDefinitions>
            <RowDefinition Height="100" />
            <RowDefinition Height="100" />
        </Grid.RowDefinitions>
        <TextBox Text="{Binding SampleCommandParam, UpdateSourceTrigger=PropertyChanged}" Margin="20">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="TextChanged">
                    <local:EventsToCommand Command="{Binding SampleCommand}"
                                           CommandParameter="{Binding SampleCommandParam}"></local:EventsToCommand>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </TextBox>            
        <TextBlock Text="{Binding Message}"
                   Grid.Row="1"
                   Padding="30"
                   FontFamily="Consolas"
                   FontWeight="14"></TextBlock>
    </Grid>
</UserControl>
```

Every thing is wired up like below. 

```
//MainWindow.xaml
<Window x:Class="Interactivity_EventToCommand.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Interactivity_EventToCommand.ViewModels"
        xmlns:view="clr-namespace:Interactivity_EventToCommand.Views"
        Title="MainWindow" Height="350" Width="525">
        <Window.DataContext>
            <local:EventToCommandDemoViewModel />
        </Window.DataContext>
    <Grid>
        <view:EventToCommandDemo />
    </Grid>
</Window>
```


References:

[event_command_redirection_using_interactivity]: http://krishnabhargav.blogspot.hk/2011/01/wpf-events-to-command-redirection-using.html
[expression_blend_kit]: http://www.microsoft.com/en-us/download/confirmation.aspx?id=10801
[WPF Events to Command redirection using System.Windows.Interactivity][event_command_redirection_using_interactivity]
[Microsoft Expression Blend Software Development Kit (SDK) for .NET 4][expression_blend_kit]

## WPF TabControl: Turning off Tab Virtualization

there is a post beofre with TabControlEx which is meant to turno off the cache all together, so that no items will be recyling the Content when we switch between the tab items. 

there is a recent post that from the Code Project, which handles the  WPF tab controls by hijacking the ContentTemplate and providing a border which the code will works out what child to be added to the content control and etc...

you can find more details on how that is achived through this link:  [WPF TabControl: Turning Off Tab Virtualization][wpf_tabcontrol_turning_off_tab]


Reference:
[WPF TabControl: Turning Off Tab Virtualization][wpf_tabcontrol_turning_off_tab]
[wpf_tabcontrol_turning_off_tab]: http://www.codeproject.com/Articles/460989/WPF-TabControl-Turning-Off-Tab-Virtualization

## Study where we can remove handler by lambada expression
I saw some code which does the following 

```
            _viewColumnsCollection.ForEach(column =>
            {
                column.ContentChanged -= ColumnContentChanged;

                var descriptor = DependencyPropertyDescriptor.FromProperty(ColumnBase.SortOrderProperty, typeof(ColumnBase));
                if (descriptor != null)
                {
                    descriptor.RemoveValueChanged(column, (s, e) => DoSave());
                }
            });
            // ...
             _viewColumnsCollection.ForEach(column =>
            {
                column.ContentChanged += ColumnContentChanged;
                var descriptor = DependencyPropertyDescriptor.FromProperty(ColumnBase.SortOrderProperty, typeof(ColumnBase));
                if (descriptor != null)
                {
                    descriptor.AddValueChanged(column, (s, e) => DoSave());
                }
            });

```

so what I am interested to find out whether it is safe to to remove the handler just like `(s, e) => DoSave()`, thought the lambda expression looks the same, (have the same construction and others) but who knows if they were creating two different lambdas?

so the concerns is 

```
descriptor.RemoveValueChanged(column, (s, e) => DoSave());
```

will actually remove the the handler that has been added by the following code. 
```
descriptor.AddValueChanged(column, (s, e) => DoSave());
```


## the C character constants

in standarded C, there are character constants, some are well-known such as the '\t', '\r', '\n' and etc... there are a few which are not quite commonly used as their friends. such as 

| character | Meaning |
|-----------|---------|
| '\v'      |  vertical tab |
| '\a'      |  audible sounds |

the meaning of the vertical tab is as such [What is a vertical tab][what_is_a_vertical_tab], in old-Unix time, it was used by the printer to  vertical movement. as explained in the below. 

> Vertical tab was used to speed up printer vertical movement. Some printers used special tab belts with various tab spots. This helped align content on forms. VT to header space, fill in header, VT to body area, fill in lines, VT to form footer. Generally it was coded in the program as a character constant. From the keyboard, it would be CTRL-K.

while in Microsoft, as pointed by the _sonicblis_ in the stackoverflow page, 

> Microsoft Word uses VT as a line separator in order to distinguish it from the normal new line function, which is used as a paragraph separator.

the key `shift-enter` is used to convert a vertical tab to paragraph return.

while I tried the '\a' in the console, it does not give me the beep..


References:
[what_is_a_vertical_tab]: http://stackoverflow.com/questions/3380538/what-is-a-vertical-tab
[What is a vertical tab][what_is_a_vertical_tab]
[text_only_format_converts_ascii_to]: http://support.microsoft.com/kb/59096/en-us
[Text Only Format converts to ASCII 11 to ASCII 13][text_only_format_converts_ascii_to]


## DevExpress data get sorted data from GridControl.DataController

while we had a data source which feed data to the GridControl that we worked on, the problem is that the User might want to export the data the way how it looks from UI.

which means that the data on the UI might have been proccessed (sorted, and etc...), if we continue to export the data directly from the data source, we cannot get the desired effect, so we have to leverage the UI functions. 

the old code that we do is 

```
            var items = DataSource.Cast<object>().ToArray();
```

while the new one is 

```
        var items = view.DataController.GetAllFilteredAndSortedRows().Cast<object.().ToArray();
```


## Study on DynamicSortingGroupBehavior

there is a DynamicSortingGroupBehavior, the behavior is attached as follow 

```
                    <b:DynamicSortingGroupingBehaviour 
                      ColumnsTrackingService="{Binding ColumnTrackingService}"
                      EnableSorting="False"
                      EnableGrouping="False"/>
```

in 

    ResultsDataTemplate.xaml

while it is attached, it listens to the 
* CollectionChanged
* CustomColumnSort

```
AssociatedObject.Columns.CollectionChanged += AssociatedObject_ColumnsCollectionChanged;
AssociatedObject.CustomColumnSort += AssociatedObject_CustomColumnSort;           
```

while it defines the action/operation to be performed when CollectionChanged and CustomColumnSort changes, but it does not tell when the Collection and CustomColumnSort will take place, will that happens on data connected or when user explicitly sort/group them??

in 

    AssociatedObject_Initialized

it has the 

* ResultsUpdated
* ResultCleared

they are event from the 

    ViewerService 

## ColumnTrackingService 

the service ColumnTrackingService has some brother services, they are called 

* IGroupService
* RowExpandingTrackingService

and when you drill down to the 

    ViewerService 
code, you will find that

OnTableChanged event from TableProvider will actually drive the OnResultsUpdateHandler() events , as in 

```
// ViewerService.cs
public void OnTableChanged(ITableProvider provider, IEnumerable<TableChange> changes)
{
    _ViewerService.OnResultsUpdatedHandler();
}
```

besides the OnResultsUpdatedHandler, there are two other handlers, they are `OnTableProvided` and `OnTableWithdrawn`..., they trigger action on `TableUpdated` and `ResultsCleared` event respectively.

on startup, the service will initialize the necessary events and their handlers


HOW DOES ColumnTrackingService TRACKS THE SAVING/LOADING of THE CONFIGURED COLUMNS

the ColumnConfiguration in ColumnTrackingService has an ID, which means it will associate itself with a DocumentId. so the Id property
```
public string Id
{
    get
    {
        return _id;
    }

    set
    {
        _id = value;

        // When the document ID is given check for column overrides.
        var cols = _columnsProvider.Get((x) => x.DocumentId == Id);
        if (cols != null)
        {
            ConfigColumns.Clear();
            ConfigColumns.AddRange(cols.Columns.OrderBy(o => o.Order));
        }
    }
}
```

check out the config server information, shown as below. 

    <root type=".Your.App.UI.DataAccess.Data.ColumnDto" xmlns="http://www.app.com/your_org/core/1.1">
        <DocumentId value="18bfa48b-efc4-4a6a-a038-5acf9397b549"/>
        <Columns type="list" listof=".Controls.UI.Grids.ColumnDetails">
            <i id="TradeDescription">
                <Header value="Trade Description"/>
                <IsVisible type="bool" value="true"/>
                <SortDirection type="null"/>
                <Width type="double" value="160"/>
                <RelativePosition type=".Controls.UI.Grids.ColumnPosition" value="None"/>
                <DisableScaling type="bool" value="false"/>
                <DisableSign type="bool" value="false"/>
                <DisableTotalling type="bool" value="false"/>
                <DisableFormatting type="bool" value="false"/>
                <Order type="int" value="0"/>
                <TextAlignment type="System.Windows.TextAlignment" value="Left"/>
                <ShowZeroAsEmpty type="bool" value="false"/>
                <IsExpanded type="bool" value="false"/>
                <ColumnDepth type="int" value="0"/>
                <ColumnType type=".Controls.UI.Grids.ColumnType" value=Value"/>
                <ApplyColourCoding type="bool" value="false"/>
                <GroupIndex type="int" value="0"/>
                <CustomSortMap type="null"/>
                <IsDefaultSort type="bool" value="false"/>
            </i>
            </i>
              <!-- ... -->

THE RELATIONSHIP OF THE HierarchyViewMode AND GUITOOLKIT

check the `HierarchyViewModel` against `ResultsViewModel`.. in `HierarhyView.xaml`, there is a

```
        <dxg:GridControl
            Grid.Row="3"
            gridext:ColumnExtensions.ColumnItemsSource="{Binding Path=ColumnItems}"
            ItemsSource="{Binding PathObservableTable}"
            behaviors:SelectedCellsBehaviour.PublishCells="True"
            behaviors:SelectedCellsBehaviour.SelectedCells="{Binding SelectedCells, Mode=TwoWay}"
            TotalSummarySource="{Binding TotalSummary}"
            TotalSummaryGeneratorTemplate="{StaticResource _summaryTemplate}"
            GroupSummarySource="{Binding TotalSummary}"
            GroupSummaryGeneratorTemplate="{StaticResource _summaryTemplate}"
            SelectionMode="Cell">
            <i:Interaction.Behaviors>
                <b:PrepareToExportBehavior
                      DataSource="{BindingData}"
                      PrepareExportCommand="{Binding HeaderContent.PopulateDataForExcel, Mode=TwoWay}"
                      ExportCommand="{Binding ExportToExcel}"
                      ExportTarget="{Binding HeaderContent.ExportDataTarget, Mode=TwoWay}"
                      DisplayOptions="{Binding DisplayOptionsViewModel}"/>
                <b:GridViewColumnManagerBehaviour
                    ColumnTrackingService="{Binding ColumnTrackingService}"/>
                <b:HierarchyColumnBackgroundBehaviour HierarchyColumnCellStyle="{StaticResource HierarchyColumnCellStyle}"/>
                <b:HidePanelsBehaviour/>
                <b:DynamicSortingGroupingBehaviour
                  ColumnsTrackingService="{Binding ColumnTrackingService}"
                  RowExpandingTrackingService="{Binding RowExpandingTrackingService}"  
                  GroupingService="{Binding ReportConfigurationViewModel}"
                  ViewerService="{Binding ViewerService}"
                  EnableGrouping="{Binding ReportConfigurationViewModel.DefaultColumnFormat.EnableRowGrouping}"  
                  EnableSorting="{Binding ReportConfigurationViewModel.DefaultColumnFormat.EnableSorting}"/>
                <b:GridSummaryUpdatingBehaviour/>
                <b:RowExpandingPersistingBehaviour RowExpandingTrackingService="{Binding RowExpandingTrackingService}"/>
            </i:Interaction.Behaviors>
            <dxg:GridControl.View>
                <dxg:TableView
                  AllowScrollToFocusedRow="False"
                  AlternationCount="{Binding ReportOptionsViewModel.DisplayOptionsViewModel.AlternationRowCount}"
                  AlternateRowBackground="{x:Static s:ModuleBrushes.PropertyGridAlternationBackgroundBrush}"
                  ShowGroupPanel="False"
                  ShowTotalSummary="{Binding ReportConfigurationViewModel.DefaultColumnFormat.ApplyColumnTotals}"
                  ShowSearchPanelMode="Never"
                  AllowMoveColumnToDropArea="False"
                  AllowSorting="{Binding ReportConfigurationViewModel.DefaultColumnFormat.EnableSorting}"
                  ShowAutoFilterRow="{Binding ReportConfigurationViewModel.DefaultColumnFormat.EnableFiltering}"
                  AllowEditing="False"
                  AllowFilterEditor="False"
                  AllowBandMoving="False"
                  AllowColumnFiltering="False"
                  AutoWidth="False"
                  AllowBestFit="True"
                  AllowHorizontalScrollingVirtualization="False"
                  ShowIndicator="False"
                  NavigationStyle="Cell"
                  TotalSummaryContentStyle="{StaticResource _totalSummaryContentStyle}"
                  GroupSummaryDisplayMode="AlignByColumns"
                  GroupColumnSummaryContentStyle="{StaticResource _groupSummaryContentStyle}"
                  GroupColumnSummaryItemTemplate="{StaticResource _groupSummaryTemplate}"
                  CellTemplateSelector="{StaticResource cellTemplateSelector}"
                  RowStyle="{StaticResource _rowStyle}"
                  RowMinHeight="0">
                  <dxg:TableView.GroupValueTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Value}"/>
                    </DataTemplate>
                  </dxg:TableView.GroupValueTemplate>
                </dxg:TableView>
            </dxg:GridControl.View>
        </dxg:GridControl>
```

the entry point ins 

    gridext:ColumnExtensions.ColumnItemsSource="{Binding Path=ColumnItems}"

so the ViewModel boundable column viewmodel is the ColumnItems, which is initialized on TableUpdateEvent, such as 

```
// HierarchyViewModel

// In the HierarchyViewModel, there is a such a HierarchyViewModel constructor 
        public HierarchyViewModel(
          //....
        )
        {
            _ViewerService.TableUpdated += ViewerServiceTableUpdated;

            if (ReportConfigurationViewModel.DefaultColumnFormat.EnableRowGrouping)
            {
                ReportConfigurationViewModel.GroupByChanged += OnGroupingSummaryChanged;
            }
        }
         ...
        private void ViewerServiceTableUpdated(object sender,ColumnArgs e)
        {
          // long process ignored here
        
```

THE HIERACHYCOLUMN IN THE AggregateColumn

in the ViewerService,  the ServiceComposer will provides the QuerryResultsProvider,  and if the results is a IHiearchicalResultsProvider, then it has a Columns of type `AggregatedKey` type.

```

// ViewerService.cs
private void OnTableUpdated(IColumnSet columnSet)
{
    EventHandlerColumnArgs> handler = TableUpdated;

    if (handler != null)
    {
        var hier = _factory.Value.QueryResultsProvider as IHierarchicalResultsProvider;
        if (hier != null)
        {
            handler(this, newColumnArgs(columnSet, hier.Columns));
            return;
        }

        handler(this, new ColumnArgs(columnSet, null));
    }
}
```

and how do we get back the `IEnumerable<AggregateKey> Columns` back?

the key is here: 

```
// HierarchicalResulsProvider

public IEnumerable<AggregateKey> Columns
{
    get
    {
        var columns = Enumerable.Empty<AggregateKey>();
        
        if (RowAxis != null && RowAxis.Any())
        {
            columns = RowAxis.Select(agg => AggregateKey.Create(new[] { agg }));
        }

        if (_columns != null)
        {
            columns = columns.Concat(_columns.Select(con => con.FormattedKey));
        }

        return columns;
    }
}

```

you may wonder where does the 

```
_columns 
```

comes from, if youdrill down to the `Provider`, it is available here 

```
// As it stands only one provider is used, this may change.
var aggregatedDataInfo = fabric.MetaData.FirstOrDefault().Value as AggregatedDataInfo;
// ...
                
var allowableColumns = (_columnFilter != null)
    ? _columnFilter(aggregatedDataInfo.Columns)
    : aggregatedDataInfo.Columns;
```

so AggregatedKey is actually columns from the "Row Axis" and the Aggregation Data info (which in turns comes from the Metadata of fabric...

QUESTION: 
So, there is a question, why do we need to build `AggregateKey` for the row Axis?

### Loading and Saving 
LOADING

while loading is done when the ColumnTrackingService is initialized  .  as in 

```
            var cols = _columnsProvider.Get((x) => x.DocumentId == null && x.ResultProviderType == _resultProviderType);
            if (cols != null)
            {
                ConfigColumns.AddRange(cols.Columns.OrderBy(o => o.Order));
            }
```

SAVING 
the saving is a bit more complicated.  first let see the code that does the real saving


while, when will the saving really happens? when it is requested to  be closed... 
 
```
// ResultsViewModel.cs
// inside the ResutlsViewModel constructor 
    _requestCloseEventHandler = (s, e) =>
        {
            _columnTrackingService.Remove();
            _rowExpandingTrackingService.Remove();
        };

    RequestClose += _requestCloseEventHandler;
```

## the ColumnInfo class. 
in Provider, there is such ColumnInfo class used .  

so what is a ColumnInfo, from the description from the Documentation, it is 

```
SavingSettings(bool delete, bool canSave = false) 
{
        
    if (_environmentService.IsUserSpoofing && !canSave)
    {
     return;
    }

    if (_viewColumnsCollection == null)
    {
     return;
    }
    
    // ...
    if (delete)
    {
        _columnsProvider.Remove(Id);
    }
    else
    {
        if (data.Columns.Count <= 100)
        {
            _columnsProvider.Set(data, Id);
        }

        ConfigColumns.Clear();
        ConfigColumns.AddRange(data.Columns.OrderBy(o => o.Order));
    }

}
```

and there is a helper class that calls the `SavingSettings`, it is called `DoSave`, and it does the following. 

```
        private void DoSave(bool canSave = false)
        {
            if (_gridControl != null && _gridControl.VisibleRowCount == 0)
            {
                return;
            }
            // ...
            Tasks.Delay(new TimeSpan(0, 0, 1))
                 .ContinueWith(
                     t => SaveSettings(false, canSave),
                     // ignored.
                     )
                 .LogTaskExceptionIfAny(Log);
        }
```

and when will the DoSave be called ?

* Column.ContentChanged (when the width of the column has changed)
* Visible Columns changed (DevExpress's GridControl.View .SortOrderProperty) 
* Sort Order changed (each ColumnBase.SortOrderProperty)
* when a column has changed its expandability. (whether a Columns is expanded or not) 

```
    // Summary:
    //     Details about a column of data on the AggregatedData instances returned by
    //     an AggregatedDataRequest
    [ModelElement("Aggregation.ColumnInfo")]
    public class ColumnInfo
    {
        public PrimitiveType? DataType { get; set; }
        public AggregateKey FormattedKey { get; set; }
        public AggregateKey Key { get; set; }
    }
```

so basically the Provider has to make one transformation from the ColumnInfo to ColumnDetails and others.

## Column relationship

* parent and child relationship between the Config  Server defined column and nonconfig defined one 

From an aggregated key, if the column has a Depth bigger than 1, then it is a sub-column (level in a hierarchy)

* Position Before dynamic and AfterDynamic

* Order of the Column  
Seems that the order of the column is determined by the ColumnDetils.Order...


## Small tips: Sorting Direction enum

you can leverage the Sorting direction enum from the System.ComponentModel.ListoSortDirection, they have the following values. 

```
    // Summary:
    //     Specifies the direction of a sort operation.
    public enum ListSortDirection
    {
        // Summary:
        //     Sorts in ascending order.
        Ascending = 0,
        //
        // Summary:
        //     Sorts in descending order.
        Descending = 1,
    }
```

## A close study on the IColumnItem, the object model that suppports composite pattern

the Composite Pattern is commonly used where a node can be a leaf node or node that has subnodes, and each node whether it is a leaf node or intermediate node has a value fields. 

let's a live example on what is called `IColumnItem` class. for one, 

```
public interface IColumnItem : INodeItem<IColumnItem>, INodeItem
```

and the INodeItem is declared as below. 
```
    public interface INodeItem : IItem, INotifyPropertyChanged, INotifyPropertyChanging
    {
        bool CanCollapse { get; }
        int Depth { get; }
        IExpandedItemCollector ExpandedItemCollector { get; set; }
        bool HasParentItem { get; }
        bool HasSubItems { get; }
        bool HiddenWhenExpanded { get; set; }
        bool IsExpanded { get; set; }
        bool IsLastSubItem { get; }
        bool IsLastUnexpandedItem { get; }
        IItemCollector ItemCollector { get; set; }
        INodeItem LastSubItem { get; }
        string NodeCaption { get; }
        INodeItem ParentItem { get; set; }
        IList SubItems { get; }
        ICommand ToggleExpandCommand { get; }
    }
```

and the INodeIte&lt;T&gt; is declared as below. 


```
    public interface INodeItem<TSubItem> : INodeItem, IItem, INotifyPropertyChanged, INotifyPropertyChanging
    {
        IObservableCollection<TSubItem> SubItems { get; }
    }
```


## The lifetime cycle management of the a DocumentViewModel
while each document is bound to a LayoutPanel, the LayoutPanel has a Close command which can be activated by the `Close` button to the right-up corner of the window.

see the 
```
    <DataTemplate
        DataType="{x:Type viewModels:ViewerLayoutManagerViewModel}">
        <DataTemplate.Resources>           
            <ResourceDictionary>
                <BooleanToVisibilityConverter x:Key="BooleanToVisibility"/>
                <converters:InvertBooleanToVisibilityConverter x:Key="InvertBooleanToVisibility"/>
                <Style TargetType="{x:Type dxd:LayoutPanel}">
                    <Setter Property="BindableName" Value="{Binding Name}" />
                    <Setter Property="Caption" Value="{Binding DisplayName}" />
                    <Setter Property="IsActive" Value="{Binding IsActive}" />
                    <Setter Property="CloseCommand" Value="{Binding CloseCommand}" />
                    <Setter Property="ControlBoxContent" Value="{Binding HeaderContent}"/>
                </Style>
               <Style TargetType="{x:Type dxd:TabbedGroup}">
                    <Setter Property="DestroyContentOnTabSwitching" Value="False" />
               </Style>
            </ResourceDictionary>
        </DataTemplate.Resources>

```

while the `DocumentContentViewModel` has the ICommand implementation, it is 

```
        public ICommand CloseCommand { get; private set; }
        // in the constructor 
        CloseCommand = new DelegateCommand<object>(OnRequestClose);

```

and the OnRequestClose only informs the handlers that has registered against it.

```
        private void OnRequestClose(object param)
        {
            EventHandler handler = RequestClose;
            if (handler != null)
            {
                handler(this, EventArgs.Empty);
            }
        }
```


## Style selector - a Live example

there is s live example on how to use a Style Selector in a ListView.

While we know we sometimes want to categories/differentiate different items based on different context, such as whether the item belongs to a specific group, whether the item has a special attributes. 

Here we will show you how to leverage the use of StyleSeletor to achieve this. 

While first I will createa  dummy model which is an enum, the definition is as follow. 

```
    public enum ModelType
    {
        [Group("4", "Group 4")]
        ModelType6,
        
        [Group("1", "Group 1")]
        ModelType1,

        [Group("2", "Group 2")]
        ModelType2,

        [Group("3", "Group 3")]
        ModelType3,

        [Group("2", "Group 2")]
        ModelTyp4,

        [Group("1", "Group 1")]
        ModelType5,
    }
```

as you can see that each model has a Group attrbiute, those attributes helps identify which group the Model should belongs to .


the definition of the attribute is as follow. 

```
    public class GroupAttribute : Attribute
    {
        #region Constructor(s)
        public GroupAttribute(string id, string title)
        {
            Id = id;
            Title = title;
        }
        #endregion

        #region Properties
        public string Id { get; set; }
        public string Title { get; set; }
        //public int Order { get; set; }
        #endregion 
    }
```

the Id of the group will uniquely identify a group (each group has an unique group)... While the title of the group will be displayed as the title of the group (used as an label) 

next let' s see the view model, the ViewModel will categories(group) the Models based on different Group attributes. 

```
    public class MainViewModel : INotifyPropertyChanged
    {
        #region Private fields 
        private IEnumerable<IGrouping<string, ModelType>> _groupedModelTypes;
        #endregion

        public IList<IGrouping<string, ModelType>> GroupedModelTypes
        {
            get
            {
                return _groupedModelTypes.ToList();
            }
        }

        public MainViewModel()
        {
            _groupedModelTypes = ((ModelType[])Enum.GetValues(typeof(ModelType))).GroupBy(v => GetAttribute(v).Id);
        }

        private GroupAttribute GetAttribute(ModelType type)
        {
            var memInfo = typeof(ModelType).GetMember(type.ToString())[0];
            if (memInfo != null)
            {
                return memInfo.GetCustomAttributes(typeof(GroupAttribute), false)[0] as GroupAttribute;
            }
            return null;
        }

        #region INotifyPropertyChanged
        public event PropertyChangedEventHandler PropertyChanged;
        #endregion

        #region Protected 
        protected void RaisePropertyChanged(string propertyName)
        {
            if (propertyName == null)
            {
                throw new ArgumentNullException(propertyName, "No-null value expected");
            }

            var temp = PropertyChanged;
            if (temp != null)
            {
                temp(this, new PropertyChangedEventArgs(propertyName));
            }
        }
        #endregion
    }
```

ONE special notes on the `GroupedModeltypes` is that it is a `System.Linq.IGrouping` type, while the type of the `IGrouping<TKey, TElement>` is that it inherits from the `IEnumerable<TElement>` types. 

```
<Window x:Class="StyleSelectorExample.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="350" Width="525">
<Window.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/StyleSelectorExample;component/Themes/MainWindow.xaml" />
            </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Window.Resources>
    <ListView
        ItemsSource="{Binding GroupedModelTypes}"
        ItemContainerStyleSelector="{StaticResource _itemSelector}">
    </ListView>
</Window>
```

well, the key here is the implemenation of the StyleSelector, which selects the appropriate styles based on the ViewModel operated on, let's first see the implementation of the StyleSelector.

```
    public class ListItemStyleSelector : StyleSelector
    {
        #region StyleSelector
        public override Style SelectStyle(object item, DependencyObject container)
        {
            var groupItem = item as IGrouping<string, ModelType>;
            if (groupItem != null)
            {
                var frameworkElem = container as FrameworkElement;
                if (frameworkElem != null)
                {
                    return frameworkElem.FindResource("Group" + groupItem.Key) as Style;
                }
            }
            return null;
        }
        #endregion
    }
```

there are several points that worth noting, 

1. the object item, the object item is the model which the ListView item should be bound to,  since our model is a List of `IGrouping<string, ModelType>` then each List View Item get bound to a separate model. the `object item` parameter is actually the data context of element which the StyleSelector is applied on.
2. Second we are looking for the resource with the name of `Group` + `Group.Key`. So, if the group is `0`, then the resource to find is `Group0`

what is left is how to organize the styles so that we can have different styles on different groups. Let's see how we achieve that. 

First we have the Style selector 

```
    <local:ListItemStyleSelector
        x:Key="_itemSelector"></local:ListItemStyleSelector>
```

then we follow down to the `Group0` style ..

```
    <Style TargetType="{x:Type ListViewItem}"
        x:Key="Group1">
        <Setter
            Property="Template"
            Value="{StaticResource _childGroupedListViewItemTemplate1}"
            ></Setter>
    </Style>
```

because we display each group (which is a list of IGrouping<string, ModelType> in a ListView another), so we will define how to display them 

```
    <ControlTemplate
        x:Key="_childGroupedListViewItemTemplate1"
        TargetType="{x:Type ListViewItem}"
        >
        <StackPanel>
        <TextBlock Text="{Binding Key}" />
        <ListView
            ItemsSource="{Binding}"
            ItemTemplate="{StaticResource group1}"
            >
        </ListView>
        </StackPanel>
    </ControlTemplate>
```

the last bit is to display each bit within the separate group of `ListViewItem`, here is the code. 

```
    <DataTemplate
        x:Key="group1" DataType="{x:Type data:ModelType}">
        <TextBlock Text="{Binding}" Background="Blue" />
    </DataTemplate>
```

References:

[styleselector]: http://msdn.microsoft.com/en-us/library/system.windows.controls.styleselector.aspx
[StyleSelector][styleselector]


## Style now this EventSetter

NOw there is more than one setter that are supported in the style definition, you can do EventSetter besides this normal Setters.

e..g 

```
<StackPanel
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  x:Class="SDKSample.EventOvw2"
  Name="dpanel2"
  Initialized="PrimeHandledToo"
>
  <StackPanel.Resources>
    <Style TargetType="{x:Type Button}">
      <EventSetter Event="Click" Handler="b1SetColor"/>
    </Style>
  </StackPanel.Resources>
  <Button>Click me</Button>
  <Button Name="ThisButton" Click="HandleThis">
    Raise event, handle it, use handled=true handler to get it anyway.
  </Button>
</StackPanel>
```


references:

[Style.Setters Property](http://msdn.microsoft.com/en-us/library/system.windows.style.setters(v=vs.110).aspx)

## Trigger with "not" condition
It seems that the Trigger do not support this "Not condition" such as 

```
<Trigger 
Property="PropertyName" Value="..." Not="True">
</Trigger>
```
but I guess you can write your own not trigger....




## A qucik way to tell if a collection of Boolean is all True/False

```
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Data;

namespace Common.UI.Converters
{
    /// <summary>
    /// Multi Boolean to Visibility Converter
    /// </summary>
    public class MultiBooleanToVisiblityConverter : IMultiValueConverter
    {
        public object Convert(object[] values, System.Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            if (values == null)
            {
                throw new ArgumentNullException("values");
            }

            CheckArgumentBoolTypes(values);

            bool allTrue = false;
            bool trueOrFalse = true;
            foreach (var value in values)
            {
                trueOrFalse &= (bool)value;
                allTrue = trueOrFalse;
                if (!trueOrFalse)
                {
                    break;
                }
            }
            allTrue &= trueOrFalse;
            return allTrue ? Visibility.Visible : Visibility.Collapsed;

        }

        public object[] ConvertBack(object value, System.Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
        {
            throw new System.NotImplementedException();
        }


        private void CheckArgumentBoolTypes(object[] values)
        {
            Debug.Assert(values != null, "Argument Error");
            foreach (var value in values)
            {
                if (!(value is bool))
                {
                    throw new ArgumentException(string.Format("Expected bool values, but found {0}", value));
                }
            }
        }
    }
}
```


while comparing to this implemenation from the StackOverflow , [How to boolean && two visibility converters](http://stackoverflow.com/questions/6501970/how-to-boolean-two-visibility-converters)

```
class MultiBooleanToVisibilityConverter : IMultiValueConverter
{
    public object Convert(object[] values,
                            Type targetType,
                            object parameter,
                            System.Globalization.CultureInfo culture)
    {
        bool visible = true;
        foreach (object value in values)
            if (value is bool)
                visible = visible && (bool)value;

        if (visible)
            return System.Windows.Visibility.Visible;
        else
            return System.Windows.Visibility.Hidden;
    }

    public object[] ConvertBack(object value,
                                Type[] targetTypes,
                                object parameter,
                                System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }
}
```




## Watch out for hte Dependency.UnsetValue 

because of the uninitialized value DependencyProeprty.UnsetValue

```
        private void CheckArgumentBoolTypes(object[] values)
        {
            Debug.Assert(values != null, "Argument Error");
            foreach (var value in values)
            {
                if (value != DependencyProperty.UnsetValue)
                {
                    if (!(value is bool))
                    {
                        throw new ArgumentException(string.Format("Expected bool values, but found {0}", value));
                    } 
                }
            }
        }
```
As comparing to the orignial version , which is as follow 

```
        private void CheckArgumentBoolTypes(object[] values)
        {
            Debug.Assert(values != null, "Argument Error");
            foreach (var value in values)
            {
                if (!(value is bool))
                {
                    throw new ArgumentException(string.Format("Expected bool values, but found {0}", value));
                } 
            }
        }
```

## To override the Theme keys, don't forget to include the ThemeName property 

you don't want to forget the themenaem when you are using the DynamicReosurce to refers to the dxgt:TableViewThemeKey

the xmlns of the dxgt is as follow. 

```
    xmlns:dxght="clr-namespace:DevExpress.Xpf.Grid.HitTest;assembly=DevExpress.Xpf.Grid.v13.1"

```

while the example use of it is as follow

```
                Style="{DynamicResource {dxgt:TableViewThemeKey ThemeName=ApplicationTheme, ResourceKey=SearchPanelContentTemplate}}" 

```

Failed to include the 'ThemeName=ApplicationTheme' will introduce wrong style in to memory.

and how does the ThemeManager has installed the ThemeName, such as ApplicationTheme?

I will show you the installer of the ThemeName-DX. the installer is as such 


```
    public static class Installer
    {
        /// <summary>
        /// Load ApplicationTheme theme by default
        /// </summary>
        public static void Install()
        {
            if (Theme.Themes.FirstOrDefault(t => t.Name == "ThemeName") == null)
            {
                var theme = new Theme("ThemeName", "/Themes.DevExpress;component/Themes/Dark.xaml") { FullName = "ThemeName", AssemblyName = "DevExpress.Xpf.Themes.v13.1" };
                Theme.RegisterTheme(theme);
            }
            
            ThemeManager.ApplicationThemeName = "ThemeName";
        }

        public static void UnInstall()
        {
            ThemeManager.ApplicationThemeName = Theme.Default.Name;
        }

        public static void InstallLight()
        {
            if (Theme.Themes.FirstOrDefault(t => t.Name == "ThemeName") == null)
            {
                var theme = new Theme("ThemeName", "/Themes.DevExpress;component/Themes/Light.xaml") { FullName = "ThemeName", AssemblyName = "DevExpress.Xpf.Themes.v13.1" };
                Theme.RegisterTheme(theme);
            }

            ThemeManager.ApplicationThemeName = "ThemeName";
        }

        public static void InstallDark()
        {
            if (Theme.Themes.FirstOrDefault(t => t.Name == "ThemeName") == null)
            {
                var theme = new Theme("ThemeName", "/Themes.DevExpress;component/Themes/Dark.xaml") { FullName = "ThemeName", AssemblyName = "DevExpress.Xpf.Themes.v13.1" };
                Theme.RegisterTheme(theme);
            }

            ThemeManager.ApplicationThemeName = "ThemeName";
        }
    }
```

Strange thing is that the "DevExpress.Xpf.Core.Theme" has the following 

```
        public Theme(string name);
        public Theme(string name, string fullName)
```

it seems the following code 
```
var theme = new Theme("ThemeName", "/Themes.DevExpress;componet/Themes/Dark.xaml"} {FullName = "ThemeName", Assembly="DevExpress.Xpf.Themes.v13.1" }
```

first create a Theme object with Fullname equal to "/Themes.DevExpress;componet/Themes/Dark.xaml" and later changes it back to "ThemeName". the is more like a Pack Url to the main Theme resource entry file.

and what the heck is the 'Asssembly="DevExpress.Xpf.Themes.v13.1"' does? Heard that it is the so-called "Name Convention"???

OK, here is the deal, 

* the first to load Resource when theme is constructed.
the theme pack url such as "/Themes.DevExpress;componet/Themes/Dark.xaml" only defines common bruches. while this defines what might varies (across theme to theme, only certain colors may differ)
* Theme name and Theme Fullname respectively in Constructor arguments and in the initialization list
the themmeName part is important in that once the theme has been installed, you can refers to the theme via the form of `{DynamicResource {dxgt:TableViewThemeKey ThemeName=ApplicationTheme, ResourceKey=SearchPanelContentTemplate}}` while in your theme fiels, you don't need to specify the ThemeName when you are defining styles. such as `Style x:Key="{dxgt:GroupRowThemeKey ResourceKey=GroupRowPresenterStyle}" TargetType="{x:Type dxg:GroupGridRowPresenter}"></Style>`; You only need to do that when you are using certain style from the application code, without doing so, the default main theme will be selected.  
* the Assembly Name 
The Assembly name actually gives an alias name (namespace to the installed themes), this is  important once because you will find that instead of hte Pack Uri to the physical .xaml files, you can see ResourceDictionary like below. (this decouple of the physical file location from the ThemeName Theme).

```
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/DevExpress.Xpf.Themes.v13.1;component/DevExpress.Xpf.Core/DevExpress.Xpf.Core/Bars/Themes/ThemeNameDX/TextSplitterControl.xaml" />
        <ResourceDictionary Source="/DevExpress.Xpf.Themes.v13.1;component/DevExpress.Xpf.Core/DevExpress.Xpf.Core/Bars/Themes/ThemeNameDX/BarContainerControl.xaml" />
```


## Don't forget to try first BorderBrush={TemplateBinding BorderBrush}
sometimes you will notice the difference of the BorderBrush, you might want to try to use 
```
<Border
  BorderBrush={TemplateBinding BorderBrush} 
...
</Border>
```
before jumping to edit with some hard-coded values. 


## TableView.FixedLineWidth=1

you can control the width of a FixedLineWidth, by the following attributes. 

```
<TableView
    FixedLineWidth="1"
</TableView>
```


## GridviewAppearances.FixedLine property and the more general Appearances 

While DevExpress has given you the ability to customize the appearances of the controls, via the [Appearance Overview](appearance_overview)

One of it is the `GridViewAppearances.FixedLine` property, which you can control fore and background of the FixedLine... such as [GridViewAppearances.FixedLine Property][gridviewappearance_fixedline]

References
[appearance_overview]: https://documentation.devexpress.com/#WindowsForms/CustomDocument755
[Appearance Overview](appearance_overview)
[gridviewappearance_fixedline]: https://documentation.devexpress.com/#WindowsForms/DevExpressXtraGridViewsGridGridViewAppearances_FixedLinetopic
[GridViewAppearances.FixedLine Property][gridviewappearance_fixedline]
[fixed_column_line_width]:https://www.devexpress.com/Support/Center/Question/Details/Q324864
[Fixed column line width][fixed_column_line_width]



## Names Viewer Builder 
while the ActiveCube and the Cube uses the '.' to separate member (hierarchy and Levels) it was not accepted by the wpf system, we have to convert the '.' to something else, which can be accepted by the Cube, here is what I find 

```
    public static class AggregateKeyExtensions
    {
        public static string BindableNameConverter(
            this AggregateKey source)
        {
            return source.Depth == 0 ? source.ToString() : string.Join("-", source.Values)
                .Replace('.', '-')
                .Replace('/', '-');
        }

```

while in the "Column" class, where a Column may have AggregatedKeys (that the AggregatedKey.Values) has an IEnumerable of keys. 

```
                public Column(
                    IEnumerable<string> names,
                    Type type,
                    int index)
                {
                    _name = string.Join("-", names);
                    _index = index;
                    _type = GetTypeOverride(_name, type);
                }
```

## Not Trigger

the normal trigger value are used for when certain condition is met, meaning if the binding value is equal to the Value property of the trigger. 

while what if I want to reverse teh condition in that I want certain action to be trigger when the binding and the value is not equal.

I have thought several meanings, one is to use the customized Triggger or reverse binding , however, that is no way to go

the only thing that we can do is to provide some triggers. However, the problem with triggers is that they are not part of the Visual Tree, and there is no SerivceSite for it to be bind to certain value. 

I have being able to made some code that has the following. 

```
using System;
using System.Windows.Data;
using NotTrigger.ViewModels;

namespace NotTrigger.Converters
{
    /// <summary>
    /// Not Equal COnverter is a converter which return not equal 
    /// </summary>
    [ValueConversion(typeof(string),typeof(bool))]
    public class NotEqualConverter :  IValueConverter
    {
        #region DependencyProperty 

        /*public static readonly DependencyProperty ValueProperty = DependencyProperty.Register(
            "Value", typeof(object), typeof(NotEqualConverter), new UIPropertyMetadata(null));*/

        #endregion

        #region Dependency Property 

        #endregion

        private object _dataContext;

        private string _explodeValue;
        public object DataContext
        {
            get
            {
                return _dataContext;
            }

            set
            {
                if (_dataContext != value)
                {
                    if (_dataContext != null)
                    {
                        ((MainWindowViewModel)_dataContext).PropertyChanged -= datacontext_PropertyChanged;
                    }

                    var datacontext = value as MainWindowViewModel;
                    if (datacontext != null)
                    {
                        datacontext.PropertyChanged += new System.ComponentModel.PropertyChangedEventHandler(datacontext_PropertyChanged);
                        _dataContext = datacontext;
                    }
                }
            }
        }

        void datacontext_PropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == "ExplodeValue")
            {
                _explodeValue = ((MainWindowViewModel)_dataContext).ExplodeValue;
            }
        }

        #region IValueConverter(Impl)
        public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            // handle the null value case
            if (value == null) return true;
            return !value.Equals(_explodeValue);
        }

        public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            throw new NotImplementedException();
        }
        #endregion
    }
}

```

The constraint with this NotEqualConverter is that we have to pass in the data context in, however, since the converter is not something in the Visual tree hierarchy.

in my example code, this is done over the following (with the data context being declared in a Resource, which makes it sharable between different elements).

```
<Window x:Class="NotTrigger.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:cnvt="clr-namespace:NotTrigger.Converters"
        xmlns:vm="clr-namespace:NotTrigger.ViewModels"
        Height="350" Width="525">
    <Window.Resources>
        <cnvt:NotEqualConverter x:Key="NotEqualConverter" />
        <vm:MainWindowViewModel x:Key="MainWindowViewModel"/>
    </Window.Resources>
    <Window.DataContext>
        <StaticResource ResourceKey="MainWindowViewModel" />
    </Window.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <TextBox
            Grid.Row="0"
            Text="{Binding ExplodeValue, UpdateSourceTrigger=PropertyChanged}"></TextBox>
        <TextBox
            Grid.Row="1"
            Text="{Binding CurrentValue, UpdateSourceTrigger=PropertyChanged}"
            >
        </TextBox>
        <TextBlock
            x:Name="Notice"
            Text="{Binding ExplodeMessage}"
            Grid.Row="2">
              <TextBlock.Style>
                <Style
                    TargetType="TextBlock">
                    <Style.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <Binding
                                    Path="CurrentValue">
                                    <Binding.Converter>
                                        <cnvt:NotEqualConverter
                                            DataContext="{StaticResource MainWindowViewModel}"></cnvt:NotEqualConverter>
                                    </Binding.Converter>
                                </Binding>
                            </DataTrigger.Binding>
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Setter Property="TextElement.Foreground" Value="Red"></Setter>
                            </DataTrigger>
                        <!-- <Trigger
                            Property="Text" Value="Exploded Message">
                            <Setter Property="Visibility" Value="Collapsed"></Setter>
                            <Setter Property="TextElement.Foreground" Value="Red"></Setter>
                        </Trigger>
                        -->
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>

        </TextBlock>
    </Grid>
</Window>
```

while next step is to find out easier ways to get hold to the DataContext of the current context. Or introduce Binding to the Converter.

## wpf - Data Holder

data holder is something that helps to convert something from not in the Visual Tree (not a dependency properties) to something that is on the Visual Tree. 

One of the DataHolder is to create a empty (no content ) content control use it as the holder (by means of the DependencyProperties) 

```
    // DataHolder.cs
    public class DataHolder : ContentControl
    {
        public static readonly DependencyProperty DataProperty =
            DependencyProperty.Register("Data", typeof(object), typeof(DataHolder), new PropertyMetadata(null));

        public object Data
        {
            get { return (object)GetValue(DataProperty); }
            set { SetValue(DataProperty, value); }
        }
    }

```

while in the .xaml flle, the empty DataHolder class is created and attached to the visual tree. 

```

    <Grid>
        <Grid.RowDefinitions>
            <!-- .. -->
        </Grid.RowDefinitions>
       <!-- the way how it does the binding registartion is as follow -->
        <controls:DataHolder x:Name="DataHolder">
            <controls:BindingHelper.Binding>
                <controls:BindingProperties
                    SourceProperty="DataContext"
                    TargetProperty="Data"
                    RelativeSourceAncestorType="Grid">
                </controls:BindingProperties>
            </controls:BindingHelper.Binding>
        </controls:DataHolder>
```

and it can be used by other part of the code such as the following

```
                        <dxGrid:CellTemplateSelector.QuantityColumnTemplate>
                            <DataTemplate>
                                <TextBlock
                                    TextAlignment="Right"
                                    Padding="2,0,2,0">
                                    <TextBlock.Style>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="Foreground">
                                                <Setter.Value>
                                                    <MultiBinding Converter="{StaticResource _cellForegroundConverter}">
                                                        <Binding Path="Value"/>
                                                        <Binding ElementName="DataHolder" Path="Data.DisplayOptionsViewModel" />
                                                        <Binding Path="Column" RelativeSource="{RelativeSource AncestorType={x:Type dxg:CellContentPresenter}}" />
                                                        <Binding ElementName="DataHolder" Path="Data.DisplayOptionsViewModel.DisplayFormatString"/>
                                                    </MultiBinding>
                                                </Setter.Value>
                                            </Setter>
                                            <!-- ...  -->
```


while this are done with the help of the BindingHelper...

```
    public static class BindingHelper
    {
        #region Dependency Property

        public static readonly DependencyProperty BindingProperty =
            DependencyProperty.RegisterAttached(
            "Binding", 
            typeof(BindingProperties), 
            typeof(BindingHelper),
            new PropertyMetadata(null, OnBinding));

        #endregion

        #region Fields

        private const BindingFlags HelperBindingFlags = BindingFlags.Public | BindingFlags.Static | BindingFlags.FlattenHierarchy;

        /// <summary>
        /// A cache of relay bindings, keyed by RelayBindingKey which specifies a property of a specific 
        /// framework element.
        /// </summary>
        private static Dictionary<RelayBindingKey, ValueObject> relayBindings =
            new Dictionary<RelayBindingKey, ValueObject>();

        #endregion

        public static BindingProperties GetBinding(DependencyObject obj)
        {
            return (BindingProperties)obj.GetValue(BindingProperty);
        }

        public static void SetBinding(DependencyObject obj, BindingProperties value)
        {
            obj.SetValue(BindingProperty, value);
        }

        private static void OnBinding(
            DependencyObject depObj, DependencyPropertyChangedEventArgs e)
        {
            var targetElement = depObj as FrameworkElement;

            targetElement.Loaded += new RoutedEventHandler(TargetElement_Loaded);
        }

        private static void TargetElement_Loaded(object sender, RoutedEventArgs e)
        {
            var depObj = sender as FrameworkElement;
            if (depObj != null)
            {
                depObj.Loaded -= TargetElement_Loaded;
            }

            FrameworkElement targetElement = sender as FrameworkElement;

            // get the value of our attached property
            BindingProperties bindingProperties = GetBinding(targetElement);

            if (bindingProperties.ElementName != null)
            {
                // perform our 'ElementName' lookup
                FrameworkElement sourceElement = targetElement.FindName(bindingProperties.ElementName) as FrameworkElement;

                // bind them
                CreateRelayBinding(targetElement, sourceElement, bindingProperties);
            }
            else if (bindingProperties.RelativeSourceSelf)
            {
                // bind an element to itself.
                CreateRelayBinding(targetElement, targetElement, bindingProperties);
            }
            else if (!string.IsNullOrEmpty(bindingProperties.RelativeSourceAncestorType))
            {
                // navigate up the tree to find the type
                DependencyObject currentObject = targetElement;

                int currentLevel = 0;
                while (currentLevel < bindingProperties.RelativeSourceAncestorLevel)
                {
                    do
                    {
                        currentObject = VisualTreeHelper.GetParent(currentObject);
                    }
                    while (currentObject.GetType().Name != bindingProperties.RelativeSourceAncestorType);
                    currentLevel++;
                }

                FrameworkElement sourceElement = currentObject as FrameworkElement;

                // bind them
                CreateRelayBinding(targetElement, sourceElement, bindingProperties);
            }
        }

        /// <summary>
        /// Creates a relay binding between the two given elements using the properties and converters
        /// detailed in the supplied bindingProperties.
        /// </summary>
        /// <param name="targetElement">The target framework element.</param>
        /// <param name="sourceElement">The source framework element.</param>
        /// <param name="bindingProperties">The binding properties.</param>
        private static void CreateRelayBinding(
            FrameworkElement targetElement, 
            FrameworkElement sourceElement,
            BindingProperties bindingProperties)
        {
            string sourcePropertyName = bindingProperties.SourceProperty + "Property";
            string targetPropertyName = bindingProperties.TargetProperty + "Property";

            // find the source dependency property
            FieldInfo[] sourceFields = sourceElement.GetType().GetFields(HelperBindingFlags);
            FieldInfo sourceDependencyPropertyField = sourceFields.First(i => i.Name == sourcePropertyName);
            DependencyProperty sourceDependencyProperty = sourceDependencyPropertyField.GetValue(null) as DependencyProperty;

            // find the target dependency property
            FieldInfo[] targetFields = targetElement.GetType().GetFields(HelperBindingFlags);
            FieldInfo targetDependencyPropertyField = targetFields.First(i => i.Name == targetPropertyName);
            var targetDependencyProperty = targetDependencyPropertyField.GetValue(null) as DependencyProperty;

            ValueObject relayObject;
            bool relayObjectBoundToSource = false;

            // create a key that identifies this source binding
            var key = new RelayBindingKey()
            {
                DependencyObject = sourceDependencyProperty,
                FrameworkElement = sourceElement
            };

            // do we already have a binding to this property?
            if (relayBindings.ContainsKey(key))
            {
                relayObject = relayBindings[key];
                relayObjectBoundToSource = true;
            }
            else
            {
                // create a relay binding between the two elements
                relayObject = new ValueObject();
            }
            
            // initialise the relay object with the source dependency property value 
            relayObject.Value = sourceElement.GetValue(sourceDependencyProperty);

            // create the binding for our target element to the relay object, this binding will
            // include the value converter
            Binding targetToRelay = new Binding();
            targetToRelay.Source = relayObject;
            targetToRelay.Path = new PropertyPath("Value");
            targetToRelay.Mode = BindingMode.TwoWay;
            targetToRelay.Converter = bindingProperties.Converter;
            targetToRelay.ConverterParameter = bindingProperties.ConverterParameter;

            // set the binding on our target element
            targetElement.SetBinding(targetDependencyProperty, targetToRelay);
            
            if (!relayObjectBoundToSource)
            {
                // create the binding for our source element to the relay object
                Binding sourceToRelay = new Binding();
                sourceToRelay.Source = relayObject;
                sourceToRelay.Path = new PropertyPath("Value");
                sourceToRelay.Mode = BindingMode.TwoWay;

                // set the binding on our source element
                sourceElement.SetBinding(sourceDependencyProperty, sourceToRelay);

                relayBindings.Add(key, relayObject);
            }                            
        }

        #region Pricvate Struct - RelayBindingKey

        private struct RelayBindingKey
        {
            public DependencyProperty DependencyObject;
            public FrameworkElement FrameworkElement;
        }

        #endregion

        #region Private Class - ValueObject

        private class ValueObject : INotifyPropertyChanged
        {
            private object _value;

            public event PropertyChangedEventHandler PropertyChanged;

            public object Value
            {
                get
                {
                    return _value;
                }

                set
                {
                    _value = value;
                    OnPropertyChanged("Value");
                }
            }

            private void OnPropertyChanged(string propertyName)
            {
                if (PropertyChanged != null)
                {
                    PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
                }
            }
        }

        #endregion
    }
```

not sure if the DataContext is a DependencyProperty, but why does the DataHolder implementation has to set the "DataProperty" part of the DataHolder?  Why not just use the DataContext part of the Control, is this some quirks that has been created by Chris Baker ?


##  How to create an zero-length array

you can create an zero-length array with the following methods 

you can do 
```
new string[] {};
```

or you can simply do the following 
```
new string[0];
}



## the ITypeList and its members

the ITypedList is what underlying the magic behinds the ObservableTable and the notification to the TableProviders to the UIs and what so ever. 

the key here is that thte ObservableTale has implemented the interface like below. 

```
    public class ObservableTable : 
                    ICollection<ObservableRow>,   
                    INotifyCollectionChanged, 
                    ITableProviderListener, 
                    ITypedList, 
                    IDisposable
```

and this is the interface member on the ITypedList that should be implemented . 

```
        /// <summary>
        /// Returns the <see cref="T:System.ComponentModel.PropertyDescriptorCollection"/> that represents the properties on each item used to bind data.
        /// </summary>
        /// <returns>
        /// The <see cref="T:System.ComponentModel.PropertyDescriptorCollection"/> that represents the properties on each item used to bind data.
        /// </returns>
        /// <param name="listAccessors">An array of <see cref="T:System.ComponentModel.PropertyDescriptor"/> objects to find in the collection as bindable. This can be null. </param>
        public PropertyDescriptorCollection GetItemProperties(PropertyDescriptor[] listAccessors)
        {
            if (m_table == null)
            {
                return new PropertyDescriptorCollection(new PropertyDescriptor[0]);
            }

            var props = m_table.ColumnSet.Columns.Select(c => new ColumnPropertyDescriptor(c)).ToArray<PropertyDescriptor>();
            return new PropertyDescriptorCollection(props);
        }
```

while the key here is that there is a ColumnPropertyDescriptor , the value is like below. 

```

    /// <summary>
    /// A property descriptor backed by an IColumn object
    /// </summary>
    public class ColumnPropertyDescriptor : PropertyDescriptor
    {
        #region Data Members

        /// <summary>
        /// The underlying column
        /// </summary>
        private readonly IColumn m_column;

        #endregion

        #region Constructors

        /// <summary>
        /// Constructor
        /// </summary>
        /// <param name="column">The underlying column</param>
        public ColumnPropertyDescriptor(IColumn column)
            : base(column.Name, null)
        {
            m_column = column;
        }

        #endregion

        #region PropertyDescriptor Overrides

        /// <summary>
        /// When overridden in a derived class, returns whether resetting an object changes its value.
        /// </summary>
        /// <returns>
        /// true if resetting the component changes its value; otherwise, false.
        /// </returns>
        /// <param name="component">The component to test for reset capability. </param>
        public override bool CanResetValue(object component)
        {
            return false;
        }

        /// <summary>
        /// When overridden in a derived class, gets the current value of the property on a component.
        /// </summary>
        /// <returns>
        /// The value of a property for a given component.
        /// </returns>
        /// <param name="component">The component with the property for which to retrieve the value. </param>
        public override object GetValue(object component)
        {
            return m_column.GetValue(((Row)component).RowObject);
        }

        /// <summary>
        /// When overridden in a derived class, resets the value for this property of the component to the default value.
        /// </summary>
        /// <param name="component">The component with the property value that is to be reset to the default value. </param>
        public override void ResetValue(object component)
        { }

        /// <summary>
        /// When overridden in a derived class, sets the value of the component to a different value.
        /// </summary>
        /// <param name="component">The component with the property value that is to be set. </param><param name="value">The new value. </param>
        public override void SetValue(object component, object value)
        { }

        /// <summary>
        /// When overridden in a derived class, determines a value indicating whether the value of this property needs to be persisted.
        /// </summary>
        /// <returns>
        /// true if the property should be persisted; otherwise, false.
        /// </returns>
        /// <param name="component">The component with the property to be examined for persistence. </param>
        public override bool ShouldSerializeValue(object component)
        {
            return false;
        }

        /// <summary>
        /// When overridden in a derived class, gets the type of the component this property is bound to.
        /// </summary>
        /// <returns>
        /// A <see cref="T:System.Type"/> that represents the type of component this property is bound to. When the <see cref="M:System.ComponentModel.PropertyDescriptor.GetValue(System.Object)"/> or <see cref="M:System.ComponentModel.PropertyDescriptor.SetValue(System.Object,System.Object)"/> methods are invoked, the object specified might be an instance of this type.
        /// </returns>
        public override Type ComponentType
        {
            get { return typeof(Row); }
        }

        /// <summary>
        /// When overridden in a derived class, gets a value indicating whether this property is read-only.
        /// </summary>
        /// <returns>
        /// true if the property is read-only; otherwise, false.
        /// </returns>
        public override bool IsReadOnly
        {
            get { return true; }
        }

        /// <summary>
        /// When overridden in a derived class, gets the type of the property.
        /// </summary>
        /// <returns>
        /// A <see cref="T:System.Type"/> that represents the type of the property.
        /// </returns>
        public override Type PropertyType
        {
            get { return m_column.Type; }
        }

        #endregion
    }
```

and the Type descriptor how they are created? 

```
    /// <summary>
    /// An object that encapsulates an object representing a row and the column set 
    /// offered by the parent table. The interface offers an abstracted mechanism for
    /// accessing the cells of the row, irrespective of the underlying storage form. 
    /// </summary>
    /// <remarks>
    /// We extend CustomTypeDescriptor rather than use the TypeDescriptionProvider attribute
    /// as some third-party libraries we're looking to use (ChartFX for one) don't support
    /// the attribute based approach.  Would be nice if they sorted themselves out, but
    /// for now we'll be pragmatic and support the lowest-common-denominator.
    /// </remarks>
    public class Row : CustomTypeDescriptor
    {
        #region Data Members

        /// <summary>
        /// The column set
        /// </summary>
        private readonly IColumnSet m_columnSet;
        
        #endregion

        #region Constructors

        /// <summary>
        /// Constructor
        /// </summary>
        /// <param name="columnSet">The column set</param>
        /// <param name="rowObject">The row object</param>
        public Row(IColumnSet columnSet, object rowObject)
        {
            ArgUtils.CheckNotNull("columnSet", columnSet);
            ArgUtils.CheckNotNull("rowObject", rowObject);

            m_columnSet = columnSet;
            RowObject = rowObject;
        }

        #endregion

        #region Public Properties

        /// <summary>
        /// Get the column set
        /// </summary>
        public IColumnSet ColumnSet
        {
            get { return m_columnSet; }
        }

        /// <summary>
        /// Get the underlying row object
        /// </summary>
        public object RowObject { get; protected set; }

        /// <summary>
        /// Get the number of cells in the row
        /// </summary>
        public int CellCount
        {
            get { return m_columnSet.Count; }
        }

        /// <summary>
        /// Get the value of the cell at the given index
        /// </summary>
        /// <param name="index">The index of the cell in the row</param>
        /// <returns>The value</returns>
        public object this[int index]
        {
            get { return m_columnSet[index].GetValue(RowObject); }
        }

        /// <summary>
        /// Get the value of the cell at the column
        /// </summary>
        /// <param name="name">The name of the column of the cell in the row</param>
        /// <returns>The value</returns>
        public virtual object this[string name]
        {
            get { return m_columnSet[name].GetValue(RowObject); }
        }

        /// <summary>
        /// Enumerate over the values of the cells in the row
        /// </summary>
        public IEnumerable<object> CellValues
        {
            get
            {
                for (int i = 0; i < m_columnSet.Count; ++i)
                {
                    yield return this[i];
                }
            }
        }

        /// <summary>
        /// Implementation of <see cref="ICustomTypeDescriptor.GetProperties()"/>
        /// </summary>
        public override PropertyDescriptorCollection GetProperties()
        {
            return m_columnSet.GetProperties();
        }

        #endregion

        #region Object Overrides

        /// <summary>
        /// Returns a <see cref="T:System.String"/> that represents the current <see cref="T:System.Object"/>.
        /// </summary>
        /// <returns>
        /// A <see cref="T:System.String"/> that represents the current <see cref="T:System.Object"/>.
        /// </returns>
        /// <filterpriority>2</filterpriority>
        public override string ToString()
        {
            StringBuilder str = new StringBuilder();
            str.Append("Row: [ ");
            str.Append(string.Join(", ", CellValues.Select(v => v ?? "(null)")));
            str.Append(" ]");

            return str.ToString();
        }

        /// <summary>
        /// Determines whether the specified <see cref="T:System.Object"/> is equal to the current <see cref="T:System.Object"/>.
        /// </summary>
        /// <returns>
        /// true if the specified <see cref="T:System.Object"/> is equal to the current <see cref="T:System.Object"/>; otherwise, false.
        /// </returns>
        /// <param name="obj">The <see cref="T:System.Object"/> to compare with the current <see cref="T:System.Object"/>. </param><filterpriority>2</filterpriority>
        public override bool Equals(object obj)
        {
            Row rhs = obj as Row;
            if (rhs == null)
            {
                return false;
            }

            return ReferenceEquals(RowObject, rhs.RowObject);
        }

        /// <summary>
        /// Serves as a hash function for a particular type. 
        /// </summary>
        /// <returns>
        /// A hash code for the current <see cref="T:System.Object"/>.
        /// </returns>
        /// <filterpriority>2</filterpriority>
        public override int GetHashCode()
        {
            return RowObject.GetHashCode();
        }

        #endregion
    }
```